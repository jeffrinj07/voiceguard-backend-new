<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>VoiceGuard AI - Respiratory Health Screening</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">

    <style>
        /* ===== RESET & BASE STYLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            display: flex;
            min-height: 100vh;
            background: linear-gradient(135deg, #FFBCD9 0%, #FFFD37 100%);
            color: #333333;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.1" d="M0,96L48,112C96,128,192,160,288,160C384,160,480,128,576,112C672,96,768,96,864,112C960,128,1056,160,1152,160C1248,160,1344,128,1392,112L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>') no-repeat bottom;
            background-size: cover;
            pointer-events: none;
        }

        /* ===== SIDEBAR ===== */
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, #FF85B3, #FF9EAA, #FFBCD9);
            color: #333333;
            padding: 25px 20px;
            display: flex;
            flex-direction: column;
            box-shadow: 5px 0 25px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 10;
        }

        .sidebar h2 {
            text-align: center;
            color: #333333;
            margin-bottom: 10px;
            font-size: 2rem;
            font-weight: 700;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.5);
        }

        .sidebar .tagline {
            text-align: center;
            font-size: 0.85rem;
            opacity: 0.9;
            margin-bottom: 30px;
            font-weight: 500;
            color: #333333;
        }

        .sidebar a {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 15px;
            color: #333333;
            text-decoration: none;
            border-radius: 12px;
            margin-bottom: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .sidebar a::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: #333333;
            transform: scaleY(0);
            transition: 0.3s;
        }

        .sidebar a:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateX(8px);
        }

        .sidebar a:hover::before {
            transform: scaleY(1);
        }

        .sidebar .icon {
            font-size: 1.3rem;
        }

        /* ===== LANGUAGE SWITCHER ===== */
        .lang-switcher {
            margin-top: auto;
            padding-top: 20px;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }

        .lang-switcher button {
            width: 100%;
            padding: 10px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.3);
            border: 1px solid rgba(0, 0, 0, 0.1);
            color: #333333;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.3s;
            font-weight: 600;
        }

        .lang-switcher button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .lang-switcher button.active {
            background: #FFFD37;
            border-color: #333333;
        }

        /* ===== USER INFO ===== */
        .user-info {
            padding: 15px;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 12px;
            margin-bottom: 20px;
            display: none;
            color: #333333;
        }

        .user-info.active {
            display: block;
        }

        .user-info p {
            margin: 5px 0;
            font-size: 0.9rem;
        }

        .user-email {
            font-weight: 600;
            color: #333333;
        }

        /* ===== MAIN CONTENT ===== */
        .main {
            flex: 1;
            padding: 30px;
            position: relative;
            z-index: 1;
        }

        .section {
            display: none;
            opacity: 0;
            transform: translateY(20px);
            transition: 0.5s ease;
        }

        .section.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ===== CARDS ===== */
        .card {
            background: white;
            padding: 35px;
            border-radius: 25px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            max-width: 950px;
            margin: auto;
            transition: 0.3s;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, #FFBCD9, #FFFD37);
        }

        .card:hover {
            box-shadow: 0 25px 70px rgba(0, 0, 0, 0.2);
            transform: translateY(-5px);
        }

        /* ===== BUTTONS ===== */
        button {
            padding: 12px 28px;
            background: linear-gradient(135deg, #FF85B3 0%, #FF9EAA 100%);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            font-size: 1rem;
            margin: 5px;
        }

        button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        button:hover::before {
            width: 300px;
            height: 300px;
        }

        button:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 25px rgba(255, 133, 179, 0.4);
        }

        button:active {
            transform: scale(0.98);
        }

        button.secondary {
            background: linear-gradient(135deg, #6c757d, #495057);
        }

        button.secondary:hover {
            box-shadow: 0 10px 25px rgba(108, 117, 125, 0.4);
        }

        button.google-btn {
            background: white;
            color: #757575;
            border: 1px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        button.google-btn:hover {
            background: #f5f5f5;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        /* ===== INPUTS ===== */
        input,
        select {
            width: 100%;
            padding: 14px;
            margin-top: 12px;
            border-radius: 12px;
            border: 2px solid #e0e0e0;
            font-size: 1rem;
            transition: 0.3s;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: #FF85B3;
            box-shadow: 0 0 0 3px rgba(255, 133, 179, 0.1);
        }

        /* ===== SYMPTOMS ===== */
        .symptom {
            display: flex;
            justify-content: space-between;
            background: linear-gradient(135deg, #FFF0F5 0%, #FFF9E3 100%);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 12px;
            align-items: center;
            transition: 0.3s;
            border: 2px solid transparent;
        }

        .symptom:hover {
            border-color: #FF85B3;
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(255, 133, 179, 0.1);
        }

        .symptom span:first-child {
            font-weight: 500;
            text-transform: capitalize;
        }

        .choice {
            padding: 8px 22px;
            border: 2px solid #FF85B3;
            border-radius: 25px;
            cursor: pointer;
            transition: 0.3s;
            margin-left: 8px;
            font-weight: 500;
        }

        .choice:hover {
            background: #FFF0F5;
        }

        .choice.selected {
            background: #FF85B3;
            color: white;
            box-shadow: 0 4px 12px rgba(255, 133, 179, 0.3);
        }

        /* ===== RESULTS ===== */
        .result-box {
            background: linear-gradient(135deg, #FFF9E3 0%, #FFE4E1 100%);
            padding: 30px;
            border-radius: 20px;
            line-height: 2;
            font-size: 1.05rem;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
        }

        .severity-badge {
            padding: 6px 16px;
            border-radius: 25px;
            color: white;
            font-weight: 700;
            display: inline-block;
            text-transform: uppercase;
            font-size: 0.9rem;
            letter-spacing: 0.5px;
        }

        .severity-mild {
            background: linear-gradient(135deg, #28a745, #20c997);
        }

        .severity-moderate {
            background: linear-gradient(135deg, #ffc107, #ff9800);
            color: #333;
        }

        .severity-severe {
            background: linear-gradient(135deg, #dc3545, #c82333);
        }

        /* ===== AUDIO ===== */
        audio {
            width: 100%;
            margin-top: 15px;
            border-radius: 12px;
        }

        /* ===== TYPOGRAPHY ===== */
        h2 {
            color: #B3305E;
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 15px;
        }

        h3 {
            color: #D6701E;
            font-size: 1.4rem;
            font-weight: 600;
            margin-top: 25px;
            margin-bottom: 15px;
        }

        /* ===== INFO GRID ===== */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .info-card {
            background: linear-gradient(135deg, #FFF0F5 0%, #FFF9C4 100%);
            padding: 25px;
            border-radius: 18px;
            border-left: 5px solid;
            transition: 0.3s;
            cursor: pointer;
        }

        .info-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.12);
        }

        .info-card h4 {
            font-size: 1.3rem;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .info-card p {
            line-height: 1.7;
            color: #333333;
            font-size: 0.95rem;
        }

        .info-card.covid {
            border-left-color: #dc3545;
        }

        .info-card.covid h4 {
            color: #dc3545;
        }

        .info-card.asthma {
            border-left-color: #28a745;
        }

        .info-card.asthma h4 {
            color: #28a745;
        }

        .info-card.bronchitis {
            border-left-color: #ffc107;
        }

        .info-card.bronchitis h4 {
            color: #d68910;
        }

        /* ===== FEATURES ===== */
        .features {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
        }

        .feature-badge {
            background: linear-gradient(135deg, #FF85B3 0%, #FF9EAA 100%);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(255, 133, 179, 0.3);
        }

        /* ===== STEPS ===== */
        .steps {
            counter-reset: step;
            margin-top: 20px;
        }

        .steps li {
            position: relative;
            padding-left: 50px;
            margin-bottom: 20px;
            line-height: 1.8;
            font-size: 1.05rem;
        }

        .steps li::before {
            counter-increment: step;
            content: counter(step);
            position: absolute;
            left: 0;
            top: 0;
            width: 35px;
            height: 35px;
            background: linear-gradient(135deg, #FF85B3, #FF9EAA);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(255, 133, 179, 0.3);
        }

        /* ===== WARNING BOX ===== */
        .warning-box {
            background: linear-gradient(135deg, #fff3cd 0%, #ffe69c 100%);
            border-left: 5px solid #ffc107;
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
            display: flex;
            align-items: start;
            gap: 15px;
        }

        .warning-box .icon {
            font-size: 2rem;
        }

        /* ===== TOAST ===== */
        #toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #FF85B3, #D6701E);
            color: white;
            padding: 18px 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            opacity: 0;
            pointer-events: none;
            transition: 0.5s;
            z-index: 9999;
            font-weight: 500;
            max-width: 400px;
        }

        /* ===== LOADING SPINNER ===== */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid #FF85B3;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* ===== RECORDING INDICATOR ===== */
        #recordingIndicator {
            display: inline-block;
            width: 14px;
            height: 14px;
            background: red;
            border-radius: 50%;
            margin-left: 10px;
            animation: pulse 1s infinite;
            vertical-align: middle;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
                opacity: 1;
            }

            50% {
                transform: scale(1.5);
                opacity: 0.5;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* ===== FORM GROUPS ===== */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }

        /* ===== LOGIN OPTIONS ===== */
        .login-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .divider {
            text-align: center;
            position: relative;
            margin: 20px 0;
            color: #666;
        }

        .divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #e0e0e0;
        }

        .divider span {
            background: white;
            padding: 0 15px;
            position: relative;
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            body {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                padding: 20px;
            }

            .main {
                padding: 20px;
            }

            .card {
                padding: 25px;
            }

            .info-grid {
                grid-template-columns: 1fr;
            }

            .features {
                justify-content: center;
            }
        }
    </style>

</head>

<body>

    <!-- ===== SIDEBAR ===== -->
    <div class="sidebar">
        <h2>üé§ VoiceGuard</h2>
        <p class="tagline" data-en="AI-Powered Health Screening" data-ta="AI ‡Æö‡Æï‡Øç‡Æ§‡Æø ‡Æï‡Øä‡Æ£‡Øç‡Æü ‡Æâ‡Æü‡Æ≤‡Øç‡Æ®‡Æ≤ ‡Æ™‡Æ∞‡Æø‡Æö‡Øã‡Æ§‡Æ©‡Øà">AI-Powered
            Health Screening</p>

        <!-- User Info Section -->
        <div class="user-info" id="userInfo">
            <p class="user-email" id="userEmail"></p>
            <p style="font-size: 0.8rem; opacity: 0.8;" id="userStatus">Not logged in</p>
        </div>

        <a onclick="show('home')">
            <span class="icon">üè†</span>
            <span data-en="Home" data-ta="‡ÆÆ‡ØÅ‡Æï‡Æ™‡Øç‡Æ™‡ØÅ">Home</span>
        </a>

        <a onclick="show('login')" id="loginNav">
            <span class="icon">üîê</span>
            <span data-en="Login / Sign Up" data-ta="‡Æâ‡Æ≥‡Øç‡Æ®‡ØÅ‡Æ¥‡Øà‡Æµ‡ØÅ / ‡Æ™‡Æ§‡Æø‡Æµ‡ØÅ">Login / Sign Up</span>
        </a>

        <a onclick="showCheckHealth()" id="checkHealthNav">
            <span class="icon">ü©∫</span>
            <span data-en="Check Health" data-ta="‡Æâ‡Æü‡Æ≤‡Øç‡Æ®‡Æø‡Æ≤‡Øà ‡Æ™‡Æ∞‡Æø‡Æö‡Øã‡Æ§‡Æ©‡Øà">Check Health</span>
        </a>

        <a onclick="showHistory()" id="historyNav">
            <span class="icon">üìã</span>
            <span data-en="History" data-ta="‡Æµ‡Æ∞‡Æ≤‡Ææ‡Æ±‡ØÅ">History</span>
        </a>

        <a onclick="logout()" id="logoutNav" style="display: none;">
            <span class="icon">üö™</span>
            <span data-en="Logout" data-ta="‡Æµ‡ØÜ‡Æ≥‡Æø‡ÆØ‡Øá‡Æ±‡ØÅ">Logout</span>
        </a>

        <div class="lang-switcher">
            <button class="active" onclick="setLanguage('en')" id="btnEn">English</button>
            <button onclick="setLanguage('ta')" id="btnTa">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</button>
        </div>
    </div>

    <!-- ===== MAIN CONTENT ===== -->
    <div class="main">

        <!-- HOME PAGE -->
        <div class="section active" id="home">
            <div class="card">
                <h2 data-en="Welcome to VoiceGuard AI" data-ta="VoiceGuard AI-‡Æï‡Øç‡Æï‡ØÅ ‡Æµ‡Æ∞‡Æµ‡Øá‡Æ±‡Øç‡Æï‡Æø‡Æ±‡Øã‡ÆÆ‡Øç">Welcome to VoiceGuard
                    AI</h2>
                <p style="margin-top:15px;font-size:1.1rem;line-height:1.8;"
                    data-en="VoiceGuard AI is an intelligent respiratory health screening system that analyzes your voice patterns and symptoms to detect respiratory diseases including COVID-19, Asthma, and Bronchitis. Our advanced AI technology helps in early detection for timely medical intervention."
                    data-ta="VoiceGuard AI ‡Æé‡Æ©‡Øç‡Æ™‡Æ§‡ØÅ ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æï‡ØÅ‡Æ∞‡Æ≤‡Øç ‡ÆÆ‡Ææ‡Æ§‡Æø‡Æ∞‡Æø‡Æï‡Æ≥‡Øç ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡ÆÖ‡Æ±‡Æø‡Æï‡ØÅ‡Æ±‡Æø‡Æï‡Æ≥‡Øà ‡Æ™‡Æï‡ØÅ‡Æ™‡Øç‡Æ™‡Ææ‡ÆØ‡Øç‡Æµ‡ØÅ ‡Æö‡ØÜ‡ÆØ‡Øç‡Æ§‡ØÅ COVID-19, ‡ÆÜ‡Æ∏‡Øç‡Æ§‡ØÅ‡ÆÆ‡Ææ ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡ÆÆ‡ØÇ‡Æö‡Øç‡Æö‡ØÅ‡Æï‡Øç‡Æï‡ØÅ‡Æ¥‡Ææ‡ÆØ‡Øç ‡ÆÖ‡Æ¥‡Æ±‡Øç‡Æö‡Æø ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æø‡Æü‡Øç‡Æü ‡Æö‡ØÅ‡Æµ‡Ææ‡Æö ‡Æ®‡Øã‡ÆØ‡Øç‡Æï‡Æ≥‡Øà‡Æï‡Øç ‡Æï‡Æ£‡Øç‡Æü‡Æ±‡Æø‡ÆØ‡ØÅ‡ÆÆ‡Øç ‡Æí‡Æ∞‡ØÅ ‡ÆÖ‡Æ±‡Æø‡Æµ‡Ææ‡Æ∞‡Øç‡Æ®‡Øç‡Æ§ ‡Æö‡ØÅ‡Æµ‡Ææ‡Æö ‡Æö‡ØÅ‡Æï‡Ææ‡Æ§‡Ææ‡Æ∞ ‡Æ™‡Æ∞‡Æø‡Æö‡Øã‡Æ§‡Æ©‡Øà ‡ÆÖ‡ÆÆ‡Øà‡Æ™‡Øç‡Æ™‡Ææ‡Æï‡ØÅ‡ÆÆ‡Øç. ‡Æé‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡ÆÆ‡Øá‡ÆÆ‡Øç‡Æ™‡Æü‡Øç‡Æü AI ‡Æ§‡Øä‡Æ¥‡Æø‡Æ≤‡Øç‡Æ®‡ØÅ‡Æü‡Øç‡Æ™‡ÆÆ‡Øç ‡Æö‡Æ∞‡Æø‡ÆØ‡Ææ‡Æ© ‡Æ®‡Øá‡Æ∞‡Æ§‡Øç‡Æ§‡Æø‡Æ≤‡Øç ‡ÆÆ‡Æ∞‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ‡Æµ ‡Æ§‡Æ≤‡Øà‡ÆØ‡ØÄ‡Æü‡Øç‡Æü‡Æø‡Æ±‡Øç‡Æï‡Ææ‡Æ© ‡ÆÜ‡Æ∞‡ÆÆ‡Øç‡Æ™ ‡Æï‡Æ£‡Øç‡Æü‡Æ±‡Æø‡Æ§‡Æ≤‡ØÅ‡Æï‡Øç‡Æï‡ØÅ ‡Æâ‡Æ§‡Æµ‡ØÅ‡Æï‡Æø‡Æ±‡Æ§‡ØÅ.">
                    VoiceGuard AI is an intelligent respiratory health screening system that analyzes your voice
                    patterns and symptoms to detect respiratory diseases including COVID-19, Asthma, and Bronchitis. Our
                    advanced AI technology helps in early detection for timely medical intervention.
                </p>

                <div class="features">
                    <span class="feature-badge" data-en="üéØ 95%+ Accuracy" data-ta="üéØ 95%+ ‡Æ§‡ØÅ‡Æ≤‡Øç‡Æ≤‡Æø‡ÆØ‡ÆÆ‡Øç">üéØ 95%+
                        Accuracy</span>
                    <span class="feature-badge" data-en="‚ö° Instant Results" data-ta="‚ö° ‡Æâ‡Æü‡Æ©‡Æü‡Æø ‡ÆÆ‡ØÅ‡Æü‡Æø‡Æµ‡ØÅ‡Æï‡Æ≥‡Øç">‚ö° Instant
                        Results</span>
                    <span class="feature-badge" data-en="üîí Secure & Private"
                        data-ta="üîí ‡Æ™‡Ææ‡Æ§‡ØÅ‡Æï‡Ææ‡Æ™‡Øç‡Æ™‡Ææ‡Æ© ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æ§‡Æ©‡Æø‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü">üîí Secure & Private</span>
                    <span class="feature-badge" data-en="üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Family Tracking"
                        data-ta="üë®‚Äçüë©‚Äçüëß‚Äçüë¶ ‡Æï‡ØÅ‡Æü‡ØÅ‡ÆÆ‡Øç‡Æ™ ‡Æï‡Æ£‡Øç‡Æï‡Ææ‡Æ£‡Æø‡Æ™‡Øç‡Æ™‡ØÅ">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Family Tracking</span>
                </div>

                <h3 data-en="Understanding Respiratory Diseases" data-ta="‡Æö‡ØÅ‡Æµ‡Ææ‡Æö ‡Æ®‡Øã‡ÆØ‡Øç‡Æï‡Æ≥‡Øà‡Æ™‡Øç ‡Æ™‡ØÅ‡Æ∞‡Æø‡Æ®‡Øç‡Æ§‡ØÅ‡Æï‡Øä‡Æ≥‡Øç‡Æ≥‡ØÅ‡Æ§‡Æ≤‡Øç">
                    Understanding Respiratory Diseases</h3>

                <div class="info-grid">
                    <div class="info-card covid">
                        <h4><span>ü¶†</span><span data-en="COVID-19" data-ta="‡Æï‡Øã‡Æµ‡Æø‡Æü‡Øç-19">COVID-19</span></h4>
                        <p data-en="A viral respiratory infection causing fever, cough, breathing difficulty, and loss of taste/smell. Early detection is crucial for treatment and preventing spread."
                            data-ta="‡Æï‡Ææ‡ÆØ‡Øç‡Æö‡Øç‡Æö‡Æ≤‡Øç, ‡Æá‡Æ∞‡ØÅ‡ÆÆ‡Æ≤‡Øç, ‡Æö‡ØÅ‡Æµ‡Ææ‡Æö‡Æø‡Æ™‡Øç‡Æ™‡Æ§‡Æø‡Æ≤‡Øç ‡Æö‡Æø‡Æ∞‡ÆÆ‡ÆÆ‡Øç ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æö‡ØÅ‡Æµ‡Øà/‡Æµ‡Ææ‡Æö‡Æ©‡Øà ‡Æá‡Æ¥‡Æ™‡Øç‡Æ™‡Øà ‡Æè‡Æ±‡Øç‡Æ™‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ‡ÆÆ‡Øç ‡Æµ‡Øà‡Æ∞‡Æ∏‡Øç ‡Æö‡ØÅ‡Æµ‡Ææ‡Æö ‡Æ®‡Øã‡ÆØ‡Øç‡Æ§‡Øç‡Æ§‡Øä‡Æ±‡Øç‡Æ±‡ØÅ. ‡Æö‡Æø‡Æï‡Æø‡Æö‡Øç‡Æö‡Øà ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æ™‡Æ∞‡Æµ‡ØÅ‡Æµ‡Æ§‡Øà‡Æ§‡Øç ‡Æ§‡Æü‡ØÅ‡Æï‡Øç‡Æï ‡ÆÜ‡Æ∞‡ÆÆ‡Øç‡Æ™ ‡Æï‡Æ£‡Øç‡Æü‡Æ±‡Æø‡Æ§‡Æ≤‡Øç ‡ÆÆ‡Æø‡Æï ‡ÆÆ‡ØÅ‡Æï‡Øç‡Æï‡Æø‡ÆØ‡ÆÆ‡Øç.">
                            A viral respiratory infection causing fever, cough, breathing difficulty, and loss of
                            taste/smell. Early detection is crucial for treatment and preventing spread.
                        </p>
                    </div>

                    <div class="info-card asthma">
                        <h4><span>ü´Å</span><span data-en="Asthma" data-ta="‡ÆÜ‡Æ∏‡Øç‡Æ§‡ØÅ‡ÆÆ‡Ææ">Asthma</span></h4>
                        <p data-en="A chronic condition causing airway inflammation, leading to wheezing, shortness of breath, and chest tightness. Proper management can control symptoms effectively."
                            data-ta="‡ÆÆ‡ØÇ‡Æö‡Øç‡Æö‡ØÅ‡Æï‡Øç‡Æï‡ØÅ‡Æ¥‡Ææ‡ÆØ‡Øç ‡Æµ‡ØÄ‡Æï‡Øç‡Æï‡Æ§‡Øç‡Æ§‡Øà ‡Æè‡Æ±‡Øç‡Æ™‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ‡ÆÆ‡Øç ‡Æ®‡Ææ‡Æü‡Øç‡Æ™‡Æü‡Øç‡Æü ‡Æ®‡Æø‡Æ≤‡Øà, ‡Æö‡ØÅ‡Æµ‡Ææ‡Æö‡Æï‡Øç ‡Æï‡ØÅ‡Æ¥‡Ææ‡ÆØ‡Øç ‡Æö‡Æ§‡Øç‡Æ§‡ÆÆ‡Øç, ‡ÆÆ‡ØÇ‡Æö‡Øç‡Æö‡ØÅ ‡Æ§‡Æø‡Æ£‡Æ±‡Æ≤‡Øç ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡ÆÆ‡Ææ‡Æ∞‡Øç‡Æ™‡ØÅ ‡Æá‡Æ±‡ØÅ‡Æï‡Øç‡Æï‡ÆÆ‡Øç ‡Æè‡Æ±‡Øç‡Æ™‡Æü‡ØÅ‡Æï‡Æø‡Æ±‡Æ§‡ØÅ. ‡Æö‡Æ∞‡Æø‡ÆØ‡Ææ‡Æ© ‡ÆÆ‡Øá‡Æ≤‡Ææ‡Æ£‡Øç‡ÆÆ‡Øà ‡ÆÖ‡Æ±‡Æø‡Æï‡ØÅ‡Æ±‡Æø‡Æï‡Æ≥‡Øà ‡Æ§‡Æø‡Æ±‡ÆÆ‡Øç‡Æ™‡Æü ‡Æï‡Æü‡Øç‡Æü‡ØÅ‡Æ™‡Øç‡Æ™‡Æü‡ØÅ‡Æ§‡Øç‡Æ§ ‡ÆÆ‡ØÅ‡Æü‡Æø‡ÆØ‡ØÅ‡ÆÆ‡Øç.">
                            A chronic condition causing airway inflammation, leading to wheezing, shortness of breath,
                            and chest tightness. Proper management can control symptoms effectively.
                        </p>
                    </div>

                    <div class="info-card bronchitis">
                        <h4><span>üå°Ô∏è</span><span data-en="Bronchitis" data-ta="‡ÆÆ‡ØÇ‡Æö‡Øç‡Æö‡ØÅ‡Æï‡Øç‡Æï‡ØÅ‡Æ¥‡Ææ‡ÆØ‡Øç ‡ÆÖ‡Æ¥‡Æ±‡Øç‡Æö‡Æø">Bronchitis</span>
                        </h4>
                        <p data-en="Inflammation of bronchial tubes causing persistent cough with mucus, chest discomfort, and fatigue. Can be acute or chronic depending on duration."
                            data-ta="‡ÆÆ‡ØÇ‡Æö‡Øç‡Æö‡ØÅ‡Æï‡Øç‡Æï‡ØÅ‡Æ¥‡Ææ‡ÆØ‡Øç ‡Æï‡ØÅ‡Æ¥‡Ææ‡ÆØ‡Øç‡Æï‡Æ≥‡Æø‡Æ©‡Øç ‡Æµ‡ØÄ‡Æï‡Øç‡Æï‡ÆÆ‡Øç, ‡Æö‡Æ≥‡Æø‡ÆØ‡ØÅ‡Æü‡Æ©‡Øç ‡Æ§‡Øä‡Æü‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÅ ‡Æá‡Æ∞‡ØÅ‡ÆÆ‡Æ≤‡Øç, ‡ÆÆ‡Ææ‡Æ∞‡Øç‡Æ™‡ØÅ ‡ÆÖ‡Æö‡Øå‡Æï‡Æ∞‡Æø‡ÆØ‡ÆÆ‡Øç ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æö‡Øã‡Æ∞‡Øç‡Æµ‡ØÅ ‡Æè‡Æ±‡Øç‡Æ™‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ‡Æï‡Æø‡Æ±‡Æ§‡ØÅ. ‡Æï‡Ææ‡Æ≤‡Æ§‡Øç‡Æ§‡Øà‡Æ™‡Øç ‡Æ™‡Øä‡Æ±‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ ‡Æ§‡ØÄ‡Æµ‡Æø‡Æ∞ ‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ ‡Æ®‡Ææ‡Æ≥‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡Ææ‡Æï ‡Æá‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡Æ≤‡Ææ‡ÆÆ‡Øç.">
                            Inflammation of bronchial tubes causing persistent cough with mucus, chest discomfort, and
                            fatigue. Can be acute or chronic depending on duration.
                        </p>
                    </div>
                </div>

                <h3 data-en="How to Use VoiceGuard" data-ta="VoiceGuard ‡Æê ‡Æé‡Æµ‡Øç‡Æµ‡Ææ‡Æ±‡ØÅ ‡Æ™‡ÆØ‡Æ©‡Øç‡Æ™‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ‡Æµ‡Æ§‡ØÅ">How to Use VoiceGuard
                </h3>

                <ol class="steps">
                    <li data-en="Login with your email or family ID to save screening history"
                        data-ta="‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡ÆÆ‡Æø‡Æ©‡Øç‡Æ©‡Æû‡Øç‡Æö‡Æ≤‡Øç ‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ ‡Æï‡ØÅ‡Æü‡ØÅ‡ÆÆ‡Øç‡Æ™ ‡ÆÖ‡Æü‡Øà‡ÆØ‡Ææ‡Æ≥‡Æ§‡Øç‡Æ§‡ØÅ‡Æü‡Æ©‡Øç ‡Æâ‡Æ≥‡Øç‡Æ®‡ØÅ‡Æ¥‡Øà‡Æ®‡Øç‡Æ§‡ØÅ ‡Æ™‡Æ∞‡Æø‡Æö‡Øã‡Æ§‡Æ©‡Øà ‡Æµ‡Æ∞‡Æ≤‡Ææ‡Æ±‡Øç‡Æ±‡Øà‡Æö‡Øç ‡Æö‡Øá‡ÆÆ‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç">
                        Login with your email or family ID to save screening history</li>
                    <li data-en="Select an existing patient or add a new family member with their age"
                        data-ta="‡Æè‡Æ±‡Øç‡Æï‡Æ©‡Æµ‡Øá ‡Æâ‡Æ≥‡Øç‡Æ≥ ‡Æ®‡Øã‡ÆØ‡Ææ‡Æ≥‡Æø‡ÆØ‡Øà‡Æ§‡Øç ‡Æ§‡Øá‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÜ‡Æü‡ØÅ‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç ‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ ‡Æµ‡ÆØ‡Æ§‡ØÅ‡Æü‡Æ©‡Øç ‡Æ™‡ØÅ‡Æ§‡Æø‡ÆØ ‡Æï‡ØÅ‡Æü‡ØÅ‡ÆÆ‡Øç‡Æ™ ‡Æâ‡Æ±‡ØÅ‡Æ™‡Øç‡Æ™‡Æø‡Æ©‡Æ∞‡Øà‡Æö‡Øç ‡Æö‡Øá‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç">
                        Select an existing patient or add a new family member with their age</li>
                    <li data-en="Carefully mark all symptoms being experienced (fever, cough, breathing issues, etc.)"
                        data-ta="‡ÆÖ‡Æ©‡ØÅ‡Æ™‡Æµ‡Æø‡Æï‡Øç‡Æï‡ØÅ‡ÆÆ‡Øç ‡ÆÖ‡Æ©‡Øà‡Æ§‡Øç‡Æ§‡ØÅ ‡ÆÖ‡Æ±‡Æø‡Æï‡ØÅ‡Æ±‡Æø‡Æï‡Æ≥‡Øà‡ÆØ‡ØÅ‡ÆÆ‡Øç ‡Æï‡Æµ‡Æ©‡ÆÆ‡Ææ‡Æï‡Æï‡Øç ‡Æï‡ØÅ‡Æ±‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç (‡Æï‡Ææ‡ÆØ‡Øç‡Æö‡Øç‡Æö‡Æ≤‡Øç, ‡Æá‡Æ∞‡ØÅ‡ÆÆ‡Æ≤‡Øç, ‡Æö‡ØÅ‡Æµ‡Ææ‡Æö‡Æ™‡Øç ‡Æ™‡Æø‡Æ∞‡Æö‡Øç‡Æö‡Æø‡Æ©‡Øà‡Æï‡Æ≥‡Øç, ‡ÆÆ‡ØÅ‡Æ§‡Æ≤‡Æø‡ÆØ‡Æ©)">
                        Carefully mark all symptoms being experienced (fever, cough, breathing issues, etc.)</li>
                    <li data-en="Record a voice sample by coughing or speaking, or upload an audio file"
                        data-ta="‡Æá‡Æ∞‡ØÅ‡ÆÆ‡Æ≤‡Øç ‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ ‡Æ™‡Øá‡Æö‡ØÅ‡Æµ‡Æ§‡Æ©‡Øç ‡ÆÆ‡ØÇ‡Æ≤‡ÆÆ‡Øç ‡Æï‡ØÅ‡Æ∞‡Æ≤‡Øç ‡ÆÆ‡Ææ‡Æ§‡Æø‡Æ∞‡Æø‡ÆØ‡Øà‡Æ™‡Øç ‡Æ™‡Æ§‡Æø‡Æµ‡ØÅ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æµ‡ØÅ‡ÆÆ‡Øç ‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ ‡ÆÜ‡Æü‡Æø‡ÆØ‡Øã ‡Æï‡Øã‡Æ™‡Øç‡Æ™‡Øà‡Æ™‡Øç ‡Æ™‡Æ§‡Æø‡Æµ‡Øá‡Æ±‡Øç‡Æ±‡Æµ‡ØÅ‡ÆÆ‡Øç">
                        Record a voice sample by coughing or speaking, or upload an audio file</li>
                    <li data-en="Get instant AI-powered analysis with disease prediction and severity assessment"
                        data-ta="‡Æ®‡Øã‡ÆØ‡Øç ‡Æï‡Æ£‡Æø‡Æ™‡Øç‡Æ™‡ØÅ ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æ§‡ØÄ‡Æµ‡Æø‡Æ∞‡Æ§‡Øç‡Æ§‡Æ©‡Øç‡ÆÆ‡Øà ‡ÆÆ‡Æ§‡Æø‡Æ™‡Øç‡Æ™‡ØÄ‡Æü‡Øç‡Æü‡ØÅ‡Æü‡Æ©‡Øç ‡Æâ‡Æü‡Æ©‡Æü‡Æø AI ‡Æö‡Æï‡Øç‡Æ§‡Æø‡ÆØ‡Æø‡Æ≤‡Ææ‡Æ© ‡Æ™‡Æï‡ØÅ‡Æ™‡Øç‡Æ™‡Ææ‡ÆØ‡Øç‡Æµ‡Øà‡Æ™‡Øç ‡Æ™‡ØÜ‡Æ±‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç">
                        Get instant AI-powered analysis with disease prediction and severity assessment</li>
                </ol>

                <div class="warning-box">
                    <span class="icon">‚ö†Ô∏è</span>
                    <div>
                        <strong data-en="Medical Disclaimer:" data-ta="‡ÆÆ‡Æ∞‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ‡Æµ ‡ÆÆ‡Æ±‡ØÅ‡Æ™‡Øç‡Æ™‡ØÅ:">Medical Disclaimer:</strong>
                        <p data-en="VoiceGuard AI is designed for early screening and awareness purposes only. It does not replace professional medical diagnosis or treatment. Always consult with qualified healthcare professionals for medical advice, diagnosis, and treatment decisions."
                            data-ta="VoiceGuard AI ‡ÆÜ‡Æ©‡Æ§‡ØÅ ‡ÆÜ‡Æ∞‡ÆÆ‡Øç‡Æ™ ‡Æ™‡Æ∞‡Æø‡Æö‡Øã‡Æ§‡Æ©‡Øà ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æµ‡Æø‡Æ¥‡Æø‡Æ™‡Øç‡Æ™‡ØÅ‡Æ£‡Æ∞‡Øç‡Æµ‡ØÅ ‡Æ®‡Øã‡Æï‡Øç‡Æï‡Æô‡Øç‡Æï‡Æ≥‡ØÅ‡Æï‡Øç‡Æï‡Ææ‡Æï ‡ÆÆ‡Æü‡Øç‡Æü‡ØÅ‡ÆÆ‡Øá ‡Æµ‡Æü‡Æø‡Æµ‡ÆÆ‡Øà‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡ØÅ‡Æ≥‡Øç‡Æ≥‡Æ§‡ØÅ. ‡Æá‡Æ§‡ØÅ ‡Æ§‡Øä‡Æ¥‡Æø‡Æ≤‡Øç‡ÆÆ‡ØÅ‡Æ±‡Øà ‡ÆÆ‡Æ∞‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ‡Æµ ‡Æ®‡Øã‡ÆØ‡Øç ‡Æï‡Æ£‡Øç‡Æü‡Æ±‡Æø‡Æ§‡Æ≤‡Øç ‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ ‡Æö‡Æø‡Æï‡Æø‡Æö‡Øç‡Æö‡Øà‡ÆØ‡Øà ‡ÆÆ‡Ææ‡Æ±‡Øç‡Æ±‡Ææ‡Æ§‡ØÅ. ‡ÆÆ‡Æ∞‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ‡Æµ ‡ÆÜ‡Æ≤‡Øã‡Æö‡Æ©‡Øà, ‡Æ®‡Øã‡ÆØ‡Øç ‡Æï‡Æ£‡Øç‡Æü‡Æ±‡Æø‡Æ§‡Æ≤‡Øç ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æö‡Æø‡Æï‡Æø‡Æö‡Øç‡Æö‡Øà ‡ÆÆ‡ØÅ‡Æü‡Æø‡Æµ‡ØÅ‡Æï‡Æ≥‡ØÅ‡Æï‡Øç‡Æï‡ØÅ ‡Æé‡Æ™‡Øç‡Æ™‡Øã‡Æ§‡ØÅ‡ÆÆ‡Øç ‡Æ§‡Æï‡ØÅ‡Æ§‡Æø‡Æµ‡Ææ‡ÆØ‡Øç‡Æ®‡Øç‡Æ§ ‡Æö‡ØÅ‡Æï‡Ææ‡Æ§‡Ææ‡Æ∞ ‡Æ®‡Æø‡Æ™‡ØÅ‡Æ£‡Æ∞‡Øç‡Æï‡Æ≥‡Øà ‡ÆÖ‡Æ£‡ØÅ‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç.">
                            VoiceGuard AI is designed for early screening and awareness purposes only. It does not
                            replace professional medical diagnosis or treatment. Always consult with qualified
                            healthcare professionals for medical advice, diagnosis, and treatment decisions.
                        </p>
                    </div>
                </div>

            </div>
        </div>

        <!-- LOGIN PAGE -->
        <div class="section" id="login">
            <div class="card">
                <h2 data-en="Login to VoiceGuard" data-ta="VoiceGuard ‡Æá‡Æ≤‡Øç ‡Æâ‡Æ≥‡Øç‡Æ®‡ØÅ‡Æ¥‡Øà‡ÆØ‡Æµ‡ØÅ‡ÆÆ‡Øç">Login to VoiceGuard</h2>

                <div class="login-options">
                    <div class="form-group">
                        <label data-en="Email:" data-ta="‡ÆÆ‡Æø‡Æ©‡Øç‡Æ©‡Æû‡Øç‡Æö‡Æ≤‡Øç:">Email:</label>
                        <input id="loginEmail" type="email" data-en-placeholder="Enter your email"
                            data-ta-placeholder="‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡ÆÆ‡Æø‡Æ©‡Øç‡Æ©‡Æû‡Øç‡Æö‡Æ≤‡Øà ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æø‡Æü‡Æµ‡ØÅ‡ÆÆ‡Øç" placeholder="Enter your email">
                    </div>

                    <div class="form-group">
                        <label data-en="Password:" data-ta="‡Æï‡Æü‡Æµ‡ØÅ‡Æö‡Øç‡Æö‡Øä‡Æ≤‡Øç:">Password:</label>
                        <input id="loginPassword" type="password" data-en-placeholder="Enter your password"
                            data-ta-placeholder="‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æï‡Æü‡Æµ‡ØÅ‡Æö‡Øç‡Æö‡Øä‡Æ≤‡Øç‡Æ≤‡Øà ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æø‡Æü‡Æµ‡ØÅ‡ÆÆ‡Øç" placeholder="Enter your password">
                    </div>

                    <button onclick="doEmailLogin()" style="margin-top:20px;" data-en="Login with Email"
                        data-ta="‡ÆÆ‡Æø‡Æ©‡Øç‡Æ©‡Æû‡Øç‡Æö‡Æ≤‡Øç ‡ÆÆ‡ØÇ‡Æ≤‡ÆÆ‡Øç ‡Æâ‡Æ≥‡Øç‡Æ®‡ØÅ‡Æ¥‡Øà‡Æï">Login with Email</button>

                    <div class="divider">
                        <span data-en="OR" data-ta="‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ">OR</span>
                    </div>

                    <button onclick="doGoogleLogin()" class="google-btn">
                        <span>üîç</span>
                        <span data-en="Sign in with Google" data-ta="Google ‡ÆÆ‡ØÇ‡Æ≤‡ÆÆ‡Øç ‡Æâ‡Æ≥‡Øç‡Æ®‡ØÅ‡Æ¥‡Øà‡Æï">Sign in with Google</span>
                    </button>

                    <p style="text-align:center;margin-top:20px;color:#666;">
                        <span data-en="Don't have an account?" data-ta="‡Æï‡Æ£‡Æï‡Øç‡Æï‡ØÅ ‡Æá‡Æ≤‡Øç‡Æ≤‡Øà‡ÆØ‡Ææ?">Don't have an account?</span>
                        <a href="javascript:void(0)" onclick="show('signup')" style="color:#667eea;margin-left:5px;"
                            data-en="Sign Up" data-ta="‡Æ™‡Æ§‡Æø‡Æµ‡ØÅ ‡Æö‡ØÜ‡ÆØ‡Øç‡Æï">Sign Up</a>
                    </p>
                </div>
            </div>
        </div>

        <!-- SIGNUP PAGE -->
        <div class="section" id="signup">
            <div class="card">
                <h2 data-en="Create Account" data-ta="‡Æï‡Æ£‡Æï‡Øç‡Æï‡Øà ‡Æâ‡Æ∞‡ØÅ‡Æµ‡Ææ‡Æï‡Øç‡Æï‡ØÅ‡Æï">Create Account</h2>

                <div class="form-group">
                    <label data-en="Full Name:" data-ta="‡ÆÆ‡ØÅ‡Æ¥‡ØÅ ‡Æ™‡ØÜ‡ÆØ‡Æ∞‡Øç:">Full Name:</label>
                    <input id="signupName" type="text" data-en-placeholder="Enter your full name"
                        data-ta-placeholder="‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡ÆÆ‡ØÅ‡Æ¥‡ØÅ ‡Æ™‡ØÜ‡ÆØ‡Æ∞‡Øà ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æø‡Æü‡Æµ‡ØÅ‡ÆÆ‡Øç" placeholder="Enter your full name">
                </div>

                <div class="form-group">
                    <label data-en="Email:" data-ta="‡ÆÆ‡Æø‡Æ©‡Øç‡Æ©‡Æû‡Øç‡Æö‡Æ≤‡Øç:">Email:</label>
                    <input id="signupEmail" type="email" data-en-placeholder="Enter your email"
                        data-ta-placeholder="‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡ÆÆ‡Æø‡Æ©‡Øç‡Æ©‡Æû‡Øç‡Æö‡Æ≤‡Øà ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æø‡Æü‡Æµ‡ØÅ‡ÆÆ‡Øç" placeholder="Enter your email">
                </div>

                <div class="form-group">
                    <label data-en="Password:" data-ta="‡Æï‡Æü‡Æµ‡ØÅ‡Æö‡Øç‡Æö‡Øä‡Æ≤‡Øç:">Password:</label>
                    <input id="signupPassword" type="password" data-en-placeholder="Create a password"
                        data-ta-placeholder="‡Æï‡Æü‡Æµ‡ØÅ‡Æö‡Øç‡Æö‡Øä‡Æ≤‡Øç‡Æ≤‡Øà ‡Æâ‡Æ∞‡ØÅ‡Æµ‡Ææ‡Æï‡Øç‡Æï‡ØÅ‡Æï" placeholder="Create a password">
                </div>

                <div class="form-group">
                    <label data-en="Confirm Password:" data-ta="‡Æï‡Æü‡Æµ‡ØÅ‡Æö‡Øç‡Æö‡Øä‡Æ≤‡Øç‡Æ≤‡Øà ‡Æâ‡Æ±‡ØÅ‡Æ§‡Æø‡Æ™‡Øç‡Æ™‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ‡Æï:">Confirm Password:</label>
                    <input id="signupConfirmPassword" type="password" data-en-placeholder="Confirm your password"
                        data-ta-placeholder="‡Æï‡Æü‡Æµ‡ØÅ‡Æö‡Øç‡Æö‡Øä‡Æ≤‡Øç‡Æ≤‡Øà ‡Æâ‡Æ±‡ØÅ‡Æ§‡Æø‡Æ™‡Øç‡Æ™‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ‡Æï" placeholder="Confirm your password">
                </div>

                <div style="display:flex;gap:15px;flex-wrap:wrap;margin-top:20px;">
                    <button onclick="show('login')" class="secondary" data-en="‚Üê Back to Login"
                        data-ta="‚Üê ‡Æâ‡Æ≥‡Øç‡Æ®‡ØÅ‡Æ¥‡Øà‡Æµ‡ØÅ‡Æï‡Øç‡Æï‡ØÅ‡Æ§‡Øç ‡Æ§‡Æø‡Æ∞‡ØÅ‡ÆÆ‡Øç‡Æ™‡ØÅ">‚Üê Back to Login</button>
                    <button onclick="doSignup()" data-en="Create Account" data-ta="‡Æï‡Æ£‡Æï‡Øç‡Æï‡Øà ‡Æâ‡Æ∞‡ØÅ‡Æµ‡Ææ‡Æï‡Øç‡Æï‡ØÅ‡Æï">Create
                        Account</button>
                </div>
            </div>
        </div>

        <!-- PATIENT SELECTION PAGE -->
        <div class="section" id="patientSelect">
            <div class="card">
                <h2 data-en="Select or Add Patient" data-ta="‡Æ®‡Øã‡ÆØ‡Ææ‡Æ≥‡Æø‡ÆØ‡Øà‡Æ§‡Øç ‡Æ§‡Øá‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÜ‡Æü‡ØÅ‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç ‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ ‡Æö‡Øá‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç">Select or
                    Add Patient</h2>

                <div class="form-group">
                    <label data-en="Existing Patient:" data-ta="‡Æè‡Æ±‡Øç‡Æï‡Æ©‡Æµ‡Øá ‡Æâ‡Æ≥‡Øç‡Æ≥ ‡Æ®‡Øã‡ÆØ‡Ææ‡Æ≥‡Æø:">Existing Patient:</label>
                    <select id="patientDropdown"></select>
                </div>

                <div class="form-group">
                    <label data-en="Or Add New Patient:" data-ta="‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ ‡Æ™‡ØÅ‡Æ§‡Æø‡ÆØ ‡Æ®‡Øã‡ÆØ‡Ææ‡Æ≥‡Æø‡ÆØ‡Øà‡Æö‡Øç ‡Æö‡Øá‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç:">Or Add New
                        Patient:</label>
                    <input id="newPatient" data-en-placeholder="Enter patient name"
                        data-ta-placeholder="‡Æ®‡Øã‡ÆØ‡Ææ‡Æ≥‡Æø‡ÆØ‡Æø‡Æ©‡Øç ‡Æ™‡ØÜ‡ÆØ‡Æ∞‡Øà ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æø‡Æü‡Æµ‡ØÅ‡ÆÆ‡Øç" placeholder="Enter patient name">
                </div>

                <div class="form-group">
                    <label data-en="Age:" data-ta="‡Æµ‡ÆØ‡Æ§‡ØÅ:">Age:</label>
                    <input id="age" type="number" min="0" max="120" data-en-placeholder="Enter age"
                        data-ta-placeholder="‡Æµ‡ÆØ‡Æ§‡Øà ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æø‡Æü‡Æµ‡ØÅ‡ÆÆ‡Øç" placeholder="Enter age">
                </div>

                <div class="form-group">
                    <label data-en="Cough Duration (days):" data-ta="‡Æá‡Æ∞‡ØÅ‡ÆÆ‡Æ≤‡Øç ‡Æï‡Ææ‡Æ≤‡ÆÆ‡Øç (‡Æ®‡Ææ‡Æü‡Øç‡Æï‡Æ≥‡Øç):">Cough Duration
                        (days):</label>
                    <input id="cough_days" type="number" min="0" max="365"
                        data-en-placeholder="How many days have you been coughing?"
                        data-ta-placeholder="‡Æé‡Æ§‡Øç‡Æ§‡Æ©‡Øà ‡Æ®‡Ææ‡Æü‡Øç‡Æï‡Æ≥‡Ææ‡Æï ‡Æá‡Æ∞‡ØÅ‡ÆÆ‡Æ≤‡Øç ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æ§‡ØÅ?"
                        placeholder="How many days have you been coughing?">
                </div>

                <button onclick="proceedSymptoms()" style="margin-top:20px;" data-en="Proceed to Symptoms"
                    data-ta="‡ÆÖ‡Æ±‡Æø‡Æï‡ØÅ‡Æ±‡Æø‡Æï‡Æ≥‡ØÅ‡Æï‡Øç‡Æï‡ØÅ‡Æö‡Øç ‡Æö‡ØÜ‡Æ≤‡Øç‡Æ≤‡Æµ‡ØÅ‡ÆÆ‡Øç">Proceed to Symptoms</button>
            </div>
        </div>

        <!-- SYMPTOMS PAGE -->
        <div class="section" id="symptoms">
            <div class="card">
                <div id="locationStatus"
                    style="padding: 10px; border-radius: 8px; margin-bottom: 15px; font-size: 0.9em; text-align: center; display: none;">
                </div>
                <h2 data-en="Mark Your Symptoms" data-ta="‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡ÆÖ‡Æ±‡Æø‡Æï‡ØÅ‡Æ±‡Æø‡Æï‡Æ≥‡Øà‡Æï‡Øç ‡Æï‡ØÅ‡Æ±‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç">Mark Your Symptoms</h2>
                <p style="margin-bottom:20px;color:#666;"
                    data-en="Please carefully select all symptoms you are experiencing:"
                    data-ta="‡Æ®‡ØÄ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡ÆÖ‡Æ©‡ØÅ‡Æ™‡Æµ‡Æø‡Æï‡Øç‡Æï‡ØÅ‡ÆÆ‡Øç ‡ÆÖ‡Æ©‡Øà‡Æ§‡Øç‡Æ§‡ØÅ ‡ÆÖ‡Æ±‡Æø‡Æï‡ØÅ‡Æ±‡Æø‡Æï‡Æ≥‡Øà‡ÆØ‡ØÅ‡ÆÆ‡Øç ‡Æï‡Æµ‡Æ©‡ÆÆ‡Ææ‡Æï‡Æ§‡Øç ‡Æ§‡Øá‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÜ‡Æü‡ØÅ‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç:">Please carefully
                    select all symptoms you are experiencing:</p>

                <div id="symptomsBox"></div>

                <div style="display:flex;gap:15px;flex-wrap:wrap;margin-top:20px;">
                    <button onclick="show('patientSelect')" class="secondary" data-en="‚Üê Back" data-ta="‚Üê ‡Æ™‡Æø‡Æ©‡Øç‡Æö‡ØÜ‡Æ≤‡Øç">‚Üê
                        Back</button>
                    <button onclick="show('audio')" data-en="Next: Record Voice" data-ta="‡ÆÖ‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡Æ§‡ØÅ: ‡Æï‡ØÅ‡Æ∞‡Æ≤‡Øç ‡Æ™‡Æ§‡Æø‡Æµ‡ØÅ">Next:
                        Record Voice</button>
                </div>
            </div>
        </div>

        <!-- AUDIO RECORDING PAGE -->
        <div class="section" id="audio">
            <div class="card">
                <h2 data-en="Voice Sample Recording" data-ta="‡Æï‡ØÅ‡Æ∞‡Æ≤‡Øç ‡ÆÆ‡Ææ‡Æ§‡Æø‡Æ∞‡Æø ‡Æ™‡Æ§‡Æø‡Æµ‡ØÅ">Voice Sample Recording <span
                        id="recordingIndicator" style="display:none"></span></h2>
                <p style="margin-bottom:20px;color:#666;" data-en="Record yourself coughing or speaking for analysis:"
                    data-ta="‡Æ™‡Æï‡ØÅ‡Æ™‡Øç‡Æ™‡Ææ‡ÆØ‡Øç‡Æµ‡Æø‡Æ±‡Øç‡Æï‡Ææ‡Æï ‡Æ®‡ØÄ‡Æô‡Øç‡Æï‡Æ≥‡Øá ‡Æá‡Æ∞‡ØÅ‡ÆÆ‡Æ≤‡Øç ‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ ‡Æ™‡Øá‡Æö‡ØÅ‡Æµ‡Æ§‡Øà‡Æ™‡Øç ‡Æ™‡Æ§‡Æø‡Æµ‡ØÅ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç:">Record yourself
                    coughing or speaking for analysis:</p>

                <div style="display:flex;gap:15px;flex-wrap:wrap;">
                    <button onclick="startRecording()" data-en="üéô Start Recording" data-ta="üéô ‡Æ™‡Æ§‡Æø‡Æµ‡Øà‡Æ§‡Øç ‡Æ§‡Øä‡Æü‡Æô‡Øç‡Æï‡ØÅ">üéô
                        Start Recording</button>
                    <button onclick="stopRecording()" data-en="‚èπ Stop Recording" data-ta="‚èπ ‡Æ™‡Æ§‡Æø‡Æµ‡Øà ‡Æ®‡Æø‡Æ±‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ">‚èπ Stop
                        Recording</button>
                    <button onclick="playRecording()" data-en="‚ñ∂ Play Recording" data-ta="‚ñ∂ ‡Æ™‡Æ§‡Æø‡Æµ‡Øà ‡Æá‡ÆØ‡Æï‡Øç‡Æï‡ØÅ">‚ñ∂ Play
                        Recording</button>
                </div>

                <audio id="playback" controls></audio>

                <div class="form-group" style="margin-top:20px;">
                    <label data-en="Or upload an audio file:" data-ta="‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ ‡ÆÜ‡Æü‡Æø‡ÆØ‡Øã ‡Æï‡Øã‡Æ™‡Øç‡Æ™‡Øà‡Æ™‡Øç ‡Æ™‡Æ§‡Æø‡Æµ‡Øá‡Æ±‡Øç‡Æ±‡Æµ‡ØÅ‡ÆÆ‡Øç:">Or upload an
                        audio file:</label>
                    <input type="file" id="audioFile" accept="audio/*">
                </div>

                <div style="display:flex;gap:15px;flex-wrap:wrap;margin-top:20px;">
                    <button onclick="show('symptoms')" class="secondary" data-en="‚Üê Back to Symptoms"
                        data-ta="‚Üê ‡ÆÖ‡Æ±‡Æø‡Æï‡ØÅ‡Æ±‡Æø‡Æï‡Æ≥‡ØÅ‡Æï‡Øç‡Æï‡ØÅ‡Æ§‡Øç ‡Æ§‡Æø‡Æ∞‡ØÅ‡ÆÆ‡Øç‡Æ™‡ØÅ">‚Üê Back to Symptoms</button>
                    <button onclick="analyze()" data-en="Analyze & Get Results"
                        data-ta="‡Æ™‡Æï‡ØÅ‡Æ™‡Øç‡Æ™‡Ææ‡ÆØ‡Øç‡Æµ‡ØÅ ‡Æö‡ØÜ‡ÆØ‡Øç‡Æ§‡ØÅ ‡ÆÆ‡ØÅ‡Æü‡Æø‡Æµ‡ØÅ‡Æï‡Æ≥‡Øà‡Æ™‡Øç ‡Æ™‡ØÜ‡Æ±‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç">Analyze & Get Results</button>
                </div>
            </div>
        </div>

        <!-- RESULTS PAGE -->
        <div class="section" id="result">
            <div class="card">
                <h2 data-en="Health Screening Results" data-ta="‡Æö‡ØÅ‡Æï‡Ææ‡Æ§‡Ææ‡Æ∞ ‡Æ™‡Æ∞‡Æø‡Æö‡Øã‡Æ§‡Æ©‡Øà ‡ÆÆ‡ØÅ‡Æü‡Æø‡Æµ‡ØÅ‡Æï‡Æ≥‡Øç">Health Screening Results
                </h2>

                <div id="loadingSpinner" class="spinner" style="display:none;"></div>

                <div class="result-box" id="resultBox"></div>

                <br>

                <div style="display:flex;gap:15px;flex-wrap:wrap;">
                    <button onclick="show('home')" data-en="Go to Home" data-ta="‡ÆÆ‡ØÅ‡Æï‡Æ™‡Øç‡Æ™‡ØÅ‡Æï‡Øç‡Æï‡ØÅ‡Æö‡Øç ‡Æö‡ØÜ‡Æ≤‡Øç">Go to Home</button>
                    <button onclick="showCheckHealth()" data-en="Check Another Person"
                        data-ta="‡Æµ‡Øá‡Æ±‡Øä‡Æ∞‡ØÅ ‡Æ®‡Æ™‡Æ∞‡Øà‡Æ™‡Øç ‡Æ™‡Æ∞‡Æø‡Æö‡Øã‡Æ§‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç">Check Another Person</button>
                    <button onclick="downloadReport()" class="secondary" data-en="üì• Download Report"
                        data-ta="üì• ‡ÆÖ‡Æ±‡Æø‡Æï‡Øç‡Æï‡Øà‡ÆØ‡Øà‡Æ™‡Øç ‡Æ™‡Æ§‡Æø‡Æµ‡Æø‡Æ±‡Æï‡Øç‡Æï‡ØÅ">üì• Download Report</button>
                </div>
            </div>
        </div>

        <!-- HISTORY PAGE -->
        <div class="section" id="history">
            <div class="card">
                <h2 data-en="Screening History" data-ta="‡Æ™‡Æ∞‡Æø‡Æö‡Øã‡Æ§‡Æ©‡Øà ‡Æµ‡Æ∞‡Æ≤‡Ææ‡Æ±‡ØÅ">Screening History</h2>

                <div class="form-group">
                    <label data-en="Select Patient:" data-ta="‡Æ®‡Øã‡ÆØ‡Ææ‡Æ≥‡Æø‡ÆØ‡Øà‡Æ§‡Øç ‡Æ§‡Øá‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÜ‡Æü‡ØÅ‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç:">Select Patient:</label>
                    <select id="historyPatients" onchange="loadHistory()"></select>
                </div>

                <div id="historyBox" style="margin-top:25px;"></div>

                <button onclick="show('home')" style="margin-top:20px;" data-en="Back to Home"
                    data-ta="‡ÆÆ‡ØÅ‡Æï‡Æ™‡Øç‡Æ™‡ØÅ‡Æï‡Øç‡Æï‡ØÅ‡Æ§‡Øç ‡Æ§‡Æø‡Æ∞‡ØÅ‡ÆÆ‡Øç‡Æ™‡ØÅ">Back to Home</button>
            </div>
        </div>

        <!-- TOAST NOTIFICATION -->
        <div id="toast"></div>

    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

    <script>
        // ===== FIREBASE CONFIGURATION =====
        const firebaseConfig = {
            apiKey: "AIzaSyB9HfRv-TF4TTdywnl-ur6cN4gQMafrpeo",
            authDomain: "voiceguard-5db49.firebaseapp.com",
            projectId: "voiceguard-5db49",
            storageBucket: "voiceguard-5db49.firebasestorage.app",
            messagingSenderId: "115924774449",
            appId: "1:115924774449:web:87a12980c7b41d9310af10"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        // ===== GLOBAL VARIABLES =====
        let currentLang = 'en';
        let loggedUser = null;
        let userEmail = null;
        let currentPatient = "";
        let mediaRecorder = null;
        let recordedBlob = null;
        let audioChunks = [];
        let currentLat = null;
        let currentLng = null;

        // ===== ALL 12 SYMPTOMS =====
        const symptoms = [
            "fever", "dry_cough", "wet_cough", "wheezing",
            "breath", "chest", "fatigue", "sore_throat",
            "smell", "night_cough", "smoker", "chronic"
        ];

        // ===== TRANSLATIONS FOR ALL SYMPTOMS =====
        const translations = {
            fever: { en: "Fever", ta: "‡Æï‡Ææ‡ÆØ‡Øç‡Æö‡Øç‡Æö‡Æ≤‡Øç" },
            dry_cough: { en: "Dry Cough", ta: "‡Æµ‡Æ±‡Æ£‡Øç‡Æü ‡Æá‡Æ∞‡ØÅ‡ÆÆ‡Æ≤‡Øç" },
            wet_cough: { en: "Wet Cough", ta: "‡Æà‡Æ∞‡ÆÆ‡Ææ‡Æ© ‡Æá‡Æ∞‡ØÅ‡ÆÆ‡Æ≤‡Øç" },
            wheezing: { en: "Wheezing", ta: "‡Æö‡ØÅ‡Æµ‡Ææ‡Æö‡Æï‡Øç ‡Æï‡ØÅ‡Æ¥‡Ææ‡ÆØ‡Øç ‡Æö‡Æ§‡Øç‡Æ§‡ÆÆ‡Øç" },
            breath: { en: "Shortness of Breath", ta: "‡ÆÆ‡ØÇ‡Æö‡Øç‡Æö‡ØÅ ‡Æ§‡Æø‡Æ£‡Æ±‡Æ≤‡Øç" },
            chest: { en: "Chest Tightness", ta: "‡ÆÆ‡Ææ‡Æ∞‡Øç‡Æ™‡ØÅ ‡Æá‡Æ±‡ØÅ‡Æï‡Øç‡Æï‡ÆÆ‡Øç" },
            fatigue: { en: "Fatigue", ta: "‡Æö‡Øã‡Æ∞‡Øç‡Æµ‡ØÅ" },
            sore_throat: { en: "Sore Throat", ta: "‡Æ§‡Øä‡Æ£‡Øç‡Æü‡Øà ‡Æµ‡Æ≤‡Æø" },
            smell: { en: "Loss of Smell/Taste", ta: "‡Æµ‡Ææ‡Æö‡Æ©‡Øà/‡Æö‡ØÅ‡Æµ‡Øà ‡Æá‡Æ¥‡Æ™‡Øç‡Æ™‡ØÅ" },
            night_cough: { en: "Night-time Cough", ta: "‡Æá‡Æ∞‡Æµ‡ØÅ ‡Æ®‡Øá‡Æ∞ ‡Æá‡Æ∞‡ØÅ‡ÆÆ‡Æ≤‡Øç" },
            smoker: { en: "Smoker", ta: "‡Æ™‡ØÅ‡Æï‡Øà‡Æ™‡Øç‡Æ™‡Æø‡Æü‡Æø‡Æ™‡Øç‡Æ™‡Æµ‡Æ∞‡Øç" },
            chronic: { en: "Chronic Condition", ta: "‡Æ®‡Ææ‡Æü‡Øç‡Æ™‡Æü‡Øç‡Æü ‡Æ®‡Æø‡Æ≤‡Øà" }
        };

        let symptomData = {};
        symptoms.forEach(s => symptomData[s] = "no");

        // ===== INITIALIZATION =====
        window.onload = function () {
            console.log("VoiceGuard AI - Initializing with Firebase...");

            // Initialize symptoms UI
            initSymptomsUI();

            // Set default language
            setLanguage('en');

            // Set up auth state listener
            setupAuthListener();

            // Test backend connection
            testBackendConnection();
        };

        // ===== FIREBASE AUTH LISTENER =====
        function setupAuthListener() {
            auth.onAuthStateChanged((user) => {
                if (user) {
                    // User is signed in
                    loggedUser = user.uid;
                    userEmail = user.email;

                    console.log("User logged in:", userEmail);

                    // Update UI
                    document.getElementById('userInfo').classList.add('active');
                    document.getElementById('userEmail').textContent = userEmail;
                    document.getElementById('userStatus').textContent = currentLang === 'en' ? "Logged in" : "‡Æâ‡Æ≥‡Øç‡Æ®‡ØÅ‡Æ¥‡Øà‡Æ®‡Øç‡Æ§‡ØÅ‡Æ≥‡Øç‡Æ≥‡Ææ‡Æ∞‡Øç";

                    // Update navigation
                    document.getElementById('loginNav').style.display = 'none';
                    document.getElementById('logoutNav').style.display = 'flex';

                    showToast(currentLang === 'en' ? "Welcome back!" : "‡ÆÆ‡ØÄ‡Æ£‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç ‡Æµ‡Æ∞‡Æµ‡Øá‡Æ±‡Øç‡Æï‡Æø‡Æ±‡Øã‡ÆÆ‡Øç!", "success");

                    // Show home page
                    show('home');
                } else {
                    // User is signed out
                    loggedUser = null;
                    userEmail = null;

                    // Update UI
                    document.getElementById('userInfo').classList.remove('active');

                    // Update navigation
                    document.getElementById('loginNav').style.display = 'flex';
                    document.getElementById('logoutNav').style.display = 'none';
                    document.getElementById('checkHealthNav').style.display = 'flex';
                    document.getElementById('historyNav').style.display = 'flex';

                    // Show login page
                    show('login');
                }
            });
        }

        // ===== AUTH FUNCTIONS =====
        async function doEmailLogin() {
            const email = document.getElementById("loginEmail").value.trim();
            const password = document.getElementById("loginPassword").value;

            if (!email || !password) {
                showToast(currentLang === 'en' ? "Please enter email and password" : "‡ÆÆ‡Æø‡Æ©‡Øç‡Æ©‡Æû‡Øç‡Æö‡Æ≤‡Øç ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æï‡Æü‡Æµ‡ØÅ‡Æö‡Øç‡Æö‡Øä‡Æ≤‡Øç‡Æ≤‡Øà ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æø‡Æü‡Æµ‡ØÅ‡ÆÆ‡Øç", "error");
                return;
            }

            try {
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                console.log("Email login successful:", userCredential.user.email);

                // Ensure user document exists (Self-Healing Fix)
                const userRef = db.collection('users').doc(userCredential.user.uid);
                const userDoc = await userRef.get();

                if (!userDoc.exists) {
                    console.log("Creating missing user profile...");
                    await userRef.set({
                        email: userCredential.user.email,
                        name: userCredential.user.displayName || "User",
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        familyMembers: [],
                        lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                    });
                } else {
                    await userRef.update({
                        lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }

                showToast(currentLang === 'en' ? "Login successful!" : "‡Æâ‡Æ≥‡Øç‡Æ®‡ØÅ‡Æ¥‡Øà‡Æµ‡ØÅ ‡Æµ‡ØÜ‡Æ±‡Øç‡Æ±‡Æø‡Æï‡Æ∞‡ÆÆ‡Ææ‡Æï ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æ§‡ØÅ!", "success");

            } catch (error) {
                console.error("Login error:", error);

                let errorMessage = currentLang === 'en' ? "Login failed: " : "‡Æâ‡Æ≥‡Øç‡Æ®‡ØÅ‡Æ¥‡Øà‡Æµ‡ØÅ ‡Æ§‡Øã‡Æ≤‡Øç‡Æµ‡Æø‡ÆØ‡ØÅ‡Æ±‡Øç‡Æ±‡Æ§‡ØÅ: ";

                switch (error.code) {
                    case 'auth/user-not-found':
                        errorMessage += currentLang === 'en' ? "User not found" : "‡Æ™‡ÆØ‡Æ©‡Æ∞‡Øç ‡Æï‡Ææ‡Æ£‡Æ™‡Øç‡Æ™‡Æü‡Æµ‡Æø‡Æ≤‡Øç‡Æ≤‡Øà";
                        break;
                    case 'auth/wrong-password':
                        errorMessage += currentLang === 'en' ? "Wrong password" : "‡Æ§‡Æµ‡Æ±‡Ææ‡Æ© ‡Æï‡Æü‡Æµ‡ØÅ‡Æö‡Øç‡Æö‡Øä‡Æ≤‡Øç";
                        break;
                    case 'auth/invalid-email':
                        errorMessage += currentLang === 'en' ? "Invalid email" : "‡Æ§‡Æµ‡Æ±‡Ææ‡Æ© ‡ÆÆ‡Æø‡Æ©‡Øç‡Æ©‡Æû‡Øç‡Æö‡Æ≤‡Øç";
                        break;
                    default:
                        errorMessage += error.message;
                }

                showToast(errorMessage, "error");
            }
        }

        async function doGoogleLogin() {
            const provider = new firebase.auth.GoogleAuthProvider();

            try {
                const result = await auth.signInWithPopup(provider);
                console.log("Google login successful:", result.user.email);

                // Create user document if it doesn't exist
                const userRef = db.collection('users').doc(result.user.uid);
                const userDoc = await userRef.get();

                if (!userDoc.exists) {
                    await userRef.set({
                        email: result.user.email,
                        name: result.user.displayName,
                        photoURL: result.user.photoURL,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        familyMembers: [],
                        lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                    });
                } else {
                    await userRef.update({
                        lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }

                showToast(currentLang === 'en' ? "Google login successful!" : "Google ‡Æâ‡Æ≥‡Øç‡Æ®‡ØÅ‡Æ¥‡Øà‡Æµ‡ØÅ ‡Æµ‡ØÜ‡Æ±‡Øç‡Æ±‡Æø‡Æï‡Æ∞‡ÆÆ‡Ææ‡Æ©‡Æ§‡ØÅ!", "success");

            } catch (error) {
                console.error("Google login error:", error);
                showToast(currentLang === 'en' ? "Google login failed" : "Google ‡Æâ‡Æ≥‡Øç‡Æ®‡ØÅ‡Æ¥‡Øà‡Æµ‡ØÅ ‡Æ§‡Øã‡Æ≤‡Øç‡Æµ‡Æø‡ÆØ‡ØÅ‡Æ±‡Øç‡Æ±‡Æ§‡ØÅ", "error");
            }
        }

        async function doSignup() {
            const name = document.getElementById("signupName").value.trim();
            const email = document.getElementById("signupEmail").value.trim();
            const password = document.getElementById("signupPassword").value;
            const confirmPassword = document.getElementById("signupConfirmPassword").value;

            if (!name || !email || !password || !confirmPassword) {
                showToast(currentLang === 'en' ? "Please fill all fields" : "‡ÆÖ‡Æ©‡Øà‡Æ§‡Øç‡Æ§‡ØÅ ‡Æ™‡ØÅ‡Æ≤‡Æô‡Øç‡Æï‡Æ≥‡Øà‡ÆØ‡ØÅ‡ÆÆ‡Øç ‡Æ®‡Æø‡Æ∞‡Æ™‡Øç‡Æ™‡Æµ‡ØÅ‡ÆÆ‡Øç", "error");
                return;
            }

            if (password !== confirmPassword) {
                showToast(currentLang === 'en' ? "Passwords don't match" : "‡Æï‡Æü‡Æµ‡ØÅ‡Æö‡Øç‡Æö‡Øä‡Æ±‡Øç‡Æï‡Æ≥‡Øç ‡Æ™‡Øä‡Æ∞‡ØÅ‡Æ®‡Øç‡Æ§‡Æµ‡Æø‡Æ≤‡Øç‡Æ≤‡Øà", "error");
                return;
            }

            if (password.length < 6) {
                showToast(currentLang === 'en' ? "Password must be at least 6 characters" : "‡Æï‡Æü‡Æµ‡ØÅ‡Æö‡Øç‡Æö‡Øä‡Æ≤‡Øç ‡Æï‡ØÅ‡Æ±‡Øà‡Æ®‡Øç‡Æ§‡Æ§‡ØÅ 6 ‡Æé‡Æ¥‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ‡Æï‡Æ≥‡Øç ‡Æá‡Æ∞‡ØÅ‡Æï‡Øç‡Æï ‡Æµ‡Øá‡Æ£‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç", "error");
                return;
            }

            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                console.log("Signup successful:", userCredential.user.uid);

                // Update user profile
                await userCredential.user.updateProfile({
                    displayName: name
                });

                // Create user document in Firestore
                await db.collection('users').doc(userCredential.user.uid).set({
                    name: name,
                    email: email,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    familyMembers: [],
                    lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                });

                showToast(currentLang === 'en' ? "Account created successfully!" : "‡Æï‡Æ£‡Æï‡Øç‡Æï‡ØÅ ‡Æµ‡ØÜ‡Æ±‡Øç‡Æ±‡Æø‡Æï‡Æ∞‡ÆÆ‡Ææ‡Æï ‡Æâ‡Æ∞‡ØÅ‡Æµ‡Ææ‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ!", "success");

                // Automatically login after signup
                show('home');

            } catch (error) {
                console.error("Signup error:", error);

                let errorMessage = currentLang === 'en' ? "Signup failed: " : "‡Æ™‡Æ§‡Æø‡Æµ‡ØÅ ‡Æ§‡Øã‡Æ≤‡Øç‡Æµ‡Æø‡ÆØ‡ØÅ‡Æ±‡Øç‡Æ±‡Æ§‡ØÅ: ";

                switch (error.code) {
                    case 'auth/email-already-in-use':
                        errorMessage += currentLang === 'en' ? "Email already in use" : "‡ÆÆ‡Æø‡Æ©‡Øç‡Æ©‡Æû‡Øç‡Æö‡Æ≤‡Øç ‡Æè‡Æ±‡Øç‡Æï‡Æ©‡Æµ‡Øá ‡Æ™‡ÆØ‡Æ©‡Øç‡Æ™‡Ææ‡Æü‡Øç‡Æü‡Æø‡Æ≤‡Øç ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æ§‡ØÅ";
                        break;
                    case 'auth/invalid-email':
                        errorMessage += currentLang === 'en' ? "Invalid email" : "‡Æ§‡Æµ‡Æ±‡Ææ‡Æ© ‡ÆÆ‡Æø‡Æ©‡Øç‡Æ©‡Æû‡Øç‡Æö‡Æ≤‡Øç";
                        break;
                    case 'auth/weak-password':
                        errorMessage += currentLang === 'en' ? "Password is too weak" : "‡Æï‡Æü‡Æµ‡ØÅ‡Æö‡Øç‡Æö‡Øä‡Æ≤‡Øç ‡ÆÆ‡Æø‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç ‡Æ™‡Æ≤‡Æµ‡ØÄ‡Æ©‡ÆÆ‡Ææ‡Æ©‡Æ§‡ØÅ";
                        break;
                    default:
                        errorMessage += error.message;
                }

                showToast(errorMessage, "error");
            }
        }

        async function logout() {
            try {
                await auth.signOut();
                console.log("User logged out");

                showToast(currentLang === 'en' ? "Logged out successfully" : "‡Æµ‡ØÜ‡Æ±‡Øç‡Æ±‡Æø‡Æï‡Æ∞‡ÆÆ‡Ææ‡Æï ‡Æµ‡ØÜ‡Æ≥‡Æø‡ÆØ‡Øá‡Æ±‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ", "success");
                show('login');

            } catch (error) {
                console.error("Logout error:", error);
                showToast(currentLang === 'en' ? "Logout failed" : "‡Æµ‡ØÜ‡Æ≥‡Æø‡ÆØ‡Øá‡Æ±‡ØÅ‡Æ§‡Æ≤‡Øç ‡Æ§‡Øã‡Æ≤‡Øç‡Æµ‡Æø‡ÆØ‡ØÅ‡Æ±‡Øç‡Æ±‡Æ§‡ØÅ", "error");
            }
        }

        function initSymptomsUI() {
            const box = document.getElementById("symptomsBox");
            box.innerHTML = "";

            symptoms.forEach(s => {
                let d = document.createElement("div");
                d.className = "symptom";
                d.innerHTML = `
                    <span class="symptom-label">${translations[s][currentLang]}</span>
                    <div>
                        <span class="choice yes-choice" onclick="setSym('${s}','yes',this)"
                            data-en="Yes" data-ta="‡ÆÜ‡ÆÆ‡Øç">${currentLang === 'en' ? 'Yes' : '‡ÆÜ‡ÆÆ‡Øç'}</span>
                        <span class="choice selected no-choice" onclick="setSym('${s}','no',this)"
                            data-en="No" data-ta="‡Æá‡Æ≤‡Øç‡Æ≤‡Øà">${currentLang === 'en' ? 'No' : '‡Æá‡Æ≤‡Øç‡Æ≤‡Øà'}</span>
                    </div>
                `;
                box.appendChild(d);
            });

            // Request location when initializing UI for screening
            getLocation();
        }

        // ===== GEOLOCATION =====
        function getLocation() {
            const statusDiv = document.getElementById("locationStatus");
            if (statusDiv) {
                statusDiv.style.display = "block";
                statusDiv.style.background = "#fff3cd";
                statusDiv.style.color = "#856404";
                statusDiv.innerHTML = currentLang === 'en'
                    ? "üìç Requesting location access..."
                    : "üìç ‡Æá‡Æ∞‡ØÅ‡Æ™‡Øç‡Æ™‡Æø‡Æü ‡ÆÖ‡Æ£‡ØÅ‡Æï‡Æ≤‡Øà‡Æï‡Øç ‡Æï‡Øã‡Æ∞‡ØÅ‡Æï‡Æø‡Æ±‡Æ§‡ØÅ...";
            }

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        currentLat = position.coords.latitude;
                        currentLng = position.coords.longitude;
                        console.log("üìç Location captured:", currentLat, currentLng);
                        if (statusDiv) {
                            statusDiv.style.background = "#d4edda";
                            statusDiv.style.color = "#155724";
                            statusDiv.innerHTML = currentLang === 'en'
                                ? `üìç Location Active (${currentLat.toFixed(2)}, ${currentLng.toFixed(2)})`
                                : `üìç ‡Æá‡Æ∞‡ØÅ‡Æ™‡Øç‡Æ™‡Æø‡Æü‡ÆÆ‡Øç ‡Æö‡ØÜ‡ÆØ‡Æ≤‡Æø‡Æ≤‡Øç ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æ§‡ØÅ (${currentLat.toFixed(2)}, ${currentLng.toFixed(2)})`;
                        }
                    },
                    (error) => {
                        console.warn("‚ö†Ô∏è Geolocation error:", error.message);
                        if (statusDiv) {
                            statusDiv.style.background = "#f8d7da";
                            statusDiv.style.color = "#721c24";
                            statusDiv.innerHTML = currentLang === 'en'
                                ? "üìç Location Disabled (Nearby hospitals won't be shown)"
                                : "üìç ‡Æá‡Æ∞‡ØÅ‡Æ™‡Øç‡Æ™‡Æø‡Æü‡ÆÆ‡Øç ‡ÆÆ‡ØÅ‡Æü‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡ØÅ‡Æ≥‡Øç‡Æ≥‡Æ§‡ØÅ (‡ÆÖ‡Æ∞‡ØÅ‡Æï‡Æø‡Æ≤‡ØÅ‡Æ≥‡Øç‡Æ≥ ‡ÆÆ‡Æ∞‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ‡Æµ‡ÆÆ‡Æ©‡Øà‡Æï‡Æ≥‡Øç ‡Æï‡Ææ‡Æü‡Øç‡Æü‡Æ™‡Øç‡Æ™‡Æü‡Ææ‡Æ§‡ØÅ)";
                        }
                    }
                );
            } else if (statusDiv) {
                statusDiv.style.display = "none";
            }
        }

        // ===== PAGE NAVIGATION =====
        function show(id) {
            document.querySelectorAll(".section").forEach(s => s.classList.remove("active"));
            document.getElementById(id).classList.add("active");

            // Special handling for specific pages
            if (id === 'history') {
                loadHistory();
            }
        }

        function showToast(msg, type = "info") {
            const toast = document.getElementById("toast");
            toast.innerText = msg;
            toast.style.opacity = 1;

            // Color coding
            if (type === "error") {
                toast.style.background = "linear-gradient(135deg, #dc3545, #c82333)";
            } else if (type === "success") {
                toast.style.background = "linear-gradient(135deg, #28a745, #20c997)";
            } else {
                toast.style.background = "linear-gradient(135deg, #1f2a8c, #3b40b3)";
            }

            setTimeout(() => {
                toast.style.opacity = 0;
            }, 3000);
        }

        // ===== HEALTH CHECK FUNCTIONS =====
        async function showCheckHealth() {
            if (!loggedUser) {
                showToast(currentLang === 'en' ? "Please login first" : "‡ÆÆ‡ØÅ‡Æ§‡Æ≤‡Æø‡Æ≤‡Øç ‡Æâ‡Æ≥‡Øç‡Æ®‡ØÅ‡Æ¥‡Øà‡ÆØ‡Æµ‡ØÅ‡ÆÆ‡Øç", "error");
                show("login");
                return;
            }

            // Reset form data
            document.getElementById("newPatient").value = "";
            document.getElementById("age").value = "";
            document.getElementById("cough_days").value = "";

            // Reset symptoms
            symptoms.forEach(s => symptomData[s] = "no");
            document.querySelectorAll(".symptom").forEach(symDiv => {
                symDiv.querySelectorAll(".choice").forEach(c => c.classList.remove("selected"));
                symDiv.querySelectorAll(".choice")[1].classList.add("selected");
            });

            // Reset audio
            recordedBlob = null;
            audioChunks = [];
            const playback = document.getElementById("playback");
            if (playback) playback.src = "";
            const audioFile = document.getElementById("audioFile");
            if (audioFile) audioFile.value = "";
            const recordingIndicator = document.getElementById("recordingIndicator");
            if (recordingIndicator) recordingIndicator.style.display = "none";

            // Load patients from Firestore
            await loadPatients();

            show("patientSelect");
        }

        async function loadPatients() {
            try {
                const userDoc = await db.collection('users').doc(loggedUser).get();
                const familyMembers = userDoc.data()?.familyMembers || [];

                let drop = document.getElementById("patientDropdown");
                drop.innerHTML = "";

                let defaultOpt = document.createElement("option");
                defaultOpt.value = "";
                defaultOpt.text = currentLang === 'en' ? "-- Select Patient --" : "-- ‡Æ®‡Øã‡ÆØ‡Ææ‡Æ≥‡Æø‡ÆØ‡Øà‡Æ§‡Øç ‡Æ§‡Øá‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÜ‡Æü‡ØÅ‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç --";
                drop.appendChild(defaultOpt);

                familyMembers.forEach(patient => {
                    let o = document.createElement("option");
                    o.text = o.value = patient;
                    drop.appendChild(o);
                });

            } catch (error) {
                console.error("Error loading patients:", error);
            }
        }

        async function proceedSymptoms() {
            const newName = document.getElementById("newPatient").value.trim();
            const selectedName = document.getElementById("patientDropdown").value;
            const age = document.getElementById("age").value.trim();
            const coughDays = document.getElementById("cough_days").value.trim();

            if (!newName && (!selectedName || selectedName === "")) {
                showToast(currentLang === 'en' ? "Please select or enter patient name" : "‡Æ®‡Øã‡ÆØ‡Ææ‡Æ≥‡Æø‡ÆØ‡Æø‡Æ©‡Øç ‡Æ™‡ØÜ‡ÆØ‡Æ∞‡Øà‡Æ§‡Øç ‡Æ§‡Øá‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÜ‡Æü‡ØÅ‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç ‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æø‡Æü‡Æµ‡ØÅ‡ÆÆ‡Øç", "error");
                return;
            }

            if (!age || isNaN(age) || age < 0 || age > 120) {
                showToast(currentLang === 'en' ? "Please enter valid age (0-120)" : "‡Æö‡Æ∞‡Æø‡ÆØ‡Ææ‡Æ© ‡Æµ‡ÆØ‡Æ§‡Øà ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æø‡Æü‡Æµ‡ØÅ‡ÆÆ‡Øç (0-120)", "error");
                return;
            }

            if (!coughDays || isNaN(coughDays) || coughDays < 0 || coughDays > 365) {
                showToast(currentLang === 'en' ? "Please enter valid cough duration (0-365 days)" : "‡Æö‡Æ∞‡Æø‡ÆØ‡Ææ‡Æ© ‡Æá‡Æ∞‡ØÅ‡ÆÆ‡Æ≤‡Øç ‡Æï‡Ææ‡Æ≤‡Æ§‡Øç‡Æ§‡Øà ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æø‡Æü‡Æµ‡ØÅ‡ÆÆ‡Øç (0-365 ‡Æ®‡Ææ‡Æü‡Øç‡Æï‡Æ≥‡Øç)", "error");
                return;
            }

            currentPatient = newName || selectedName;

            // Save patient to Firestore if new
            if (newName) {
                try {
                    const userRef = db.collection('users').doc(loggedUser);
                    // Use set with merge:true to create document if it's still missing for some reason
                    await userRef.set({
                        familyMembers: firebase.firestore.FieldValue.arrayUnion(newName)
                    }, { merge: true });
                } catch (error) {
                    console.error("Error saving patient:", error);
                }
            }

            show("symptoms");
        }

        function setSym(s, v, e) {
            symptomData[s] = v;
            e.parentNode.querySelectorAll(".choice").forEach(c => c.classList.remove("selected"));
            e.classList.add("selected");
        }

        // ===== AUDIO RECORDING =====
        async function startRecording() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    audio: {
                        echoCancellation: true,
                        noiseSuppression: true,
                        sampleRate: 44100
                    }
                });

                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];

                mediaRecorder.ondataavailable = e => {
                    if (e.data.size > 0) {
                        audioChunks.push(e.data);
                    }
                };

                mediaRecorder.onstop = async () => {
                    // Convert chunks to a single Buffer/Blob
                    const webmBlob = new Blob(audioChunks, { type: "audio/webm" });

                    // Convert WebM to WAV for better compatibility with backend librosa/soundfile
                    try {
                        recordedBlob = await convertToWav(webmBlob);
                        console.log("‚úÖ Audio converted to WAV:", recordedBlob.size, "bytes");
                    } catch (e) {
                        console.error("‚ùå WAV conversion failed, using WebM fallback:", e);
                        recordedBlob = webmBlob;
                    }

                    const playback = document.getElementById("playback");
                    if (playback) {
                        playback.src = URL.createObjectURL(recordedBlob);
                    }
                    const recordingIndicator = document.getElementById("recordingIndicator");
                    if (recordingIndicator) {
                        recordingIndicator.style.display = "none";
                    }
                    showToast(currentLang === 'en' ? "Recording stopped ‚úÖ" : "‡Æ™‡Æ§‡Æø‡Æµ‡ØÅ ‡Æ®‡Æø‡Æ±‡ØÅ‡Æ§‡Øç‡Æ§‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ ‚úÖ", "success");

                    // Stop all tracks
                    stream.getTracks().forEach(track => track.stop());
                };

                mediaRecorder.start();
                const recordingIndicator = document.getElementById("recordingIndicator");
                if (recordingIndicator) {
                    recordingIndicator.style.display = "inline-block";
                }
                showToast(currentLang === 'en' ? "Recording started üéô (Speak or cough)" : "‡Æ™‡Æ§‡Æø‡Æµ‡ØÅ ‡Æ§‡Øä‡Æü‡Æô‡Øç‡Æï‡Æø‡ÆØ‡Æ§‡ØÅ üéô (‡Æ™‡Øá‡Æö‡Æµ‡ØÅ‡ÆÆ‡Øç ‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ ‡Æá‡Æ∞‡ØÅ‡ÆÆ‡Æµ‡ØÅ‡ÆÆ‡Øç)", "success");

            } catch (error) {
                console.error("Recording error:", error);
                showToast(currentLang === 'en' ? "Microphone access denied or not available" : "‡ÆÆ‡Øà‡Æï‡Øç‡Æ∞‡Øã‡ÆÉ‡Æ™‡Øã‡Æ©‡Øç ‡ÆÖ‡Æ£‡ØÅ‡Æï‡Æ≤‡Øç ‡ÆÆ‡Æ±‡ØÅ‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ ‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ ‡Æï‡Æø‡Æü‡Øà‡Æï‡Øç‡Æï‡Æµ‡Æø‡Æ≤‡Øç‡Æ≤‡Øà", "error");
            }
        }

        function stopRecording() {
            if (mediaRecorder && mediaRecorder.state === "recording") {
                mediaRecorder.stop();
            }
        }

        async function convertToWav(blob) {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const arrayBuffer = await blob.arrayBuffer();
            const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);

            const wavBuffer = audioBufferToWav(audioBuffer);
            return new Blob([wavBuffer], { type: "audio/wav" });
        }

        function audioBufferToWav(buffer) {
            const numOfChan = buffer.numberOfChannels;
            const length = buffer.length * numOfChan * 2 + 44;
            const bufferArray = new ArrayBuffer(length);
            const view = new DataView(bufferArray);

            const channels = [];
            let i, sample;
            let offset = 0;
            let pos = 0;

            // Write WAV header
            setUint32(0x46464952);                         // "RIFF"
            setUint32(length - 8);                         // file length - 8
            setUint32(0x45564157);                         // "WAVE"

            setUint32(0x20746d66);                         // "fmt " chunk
            setUint32(16);                                 // length = 16
            setUint16(1);                                  // PCM (uncompressed)
            setUint16(numOfChan);
            setUint32(buffer.sampleRate);
            setUint32(buffer.sampleRate * 2 * numOfChan); // avg. bytes/sec
            setUint16(numOfChan * 2);                      // block-align
            setUint16(16);                                 // 16-bit

            setUint32(0x61746164);                         // "data" - chunk
            setUint32(length - pos - 4);                   // chunk length

            // Write interleaved samples
            for (i = 0; i < buffer.numberOfChannels; i++)
                channels.push(buffer.getChannelData(i));

            while (pos < length) {
                for (i = 0; i < numOfChan; i++) {             // interleave channels
                    sample = Math.max(-1, Math.min(1, channels[i][offset])); // clamp
                    sample = (sample < 0 ? sample * 0x8000 : sample * 0x7FFF); // scale to 16-bit signed int
                    view.setInt16(pos, sample, true);          // update data view
                    pos += 2;
                }
                offset++;
            }

            return bufferArray;

            function setUint16(data) {
                view.setUint16(pos, data, true);
                pos += 2;
            }

            function setUint32(data) {
                view.setUint32(pos, data, true);
                pos += 4;
            }
        }

        function playRecording() {
            const playback = document.getElementById("playback");
            if (playback && playback.src) {
                playback.play();
            } else {
                showToast(currentLang === 'en' ? "No recording to play" : "‡Æá‡ÆØ‡Æï‡Øç‡Æï ‡Æé‡Æ®‡Øç‡Æ§ ‡Æ™‡Æ§‡Æø‡Æµ‡ØÅ‡ÆÆ‡Øç ‡Æá‡Æ≤‡Øç‡Æ≤‡Øà", "error");
            }
        }

        // ===== ANALYSIS =====
        async function analyze() {
            show("result");
            const resultBox = document.getElementById("resultBox");
            const spinner = document.getElementById("loadingSpinner");

            if (spinner) {
                spinner.style.display = "block";
            }

            if (resultBox) {
                resultBox.innerHTML = currentLang === 'en'
                    ? "<p style='text-align:center; color: #667eea;'><div class='spinner'></div>Analyzing your symptoms and audio...</p>"
                    : "<p style='text-align:center; color: #667eea;'><div class='spinner'></div>‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡ÆÖ‡Æ±‡Æø‡Æï‡ØÅ‡Æ±‡Æø‡Æï‡Æ≥‡Øç ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡ÆÜ‡Æü‡Æø‡ÆØ‡Øã‡Æµ‡Øà ‡Æ™‡Æï‡ØÅ‡Æ™‡Øç‡Æ™‡Ææ‡ÆØ‡Øç‡Æµ‡ØÅ ‡Æö‡ØÜ‡ÆØ‡Øç‡Æï‡Æø‡Æ±‡Æ§‡ØÅ...</p>";
            }

            try {
                // Get form data
                const age = document.getElementById("age").value;
                const coughDays = document.getElementById("cough_days").value;

                // Prepare data for backend
                const formData = new FormData();
                formData.append("symptoms", JSON.stringify(symptomData));
                formData.append("age", age);
                formData.append("cough_days", coughDays);
                formData.append("language", currentLang);
                formData.append("userId", loggedUser);
                formData.append("patientName", currentPatient);

                if (currentLat) formData.append("lat", currentLat);
                if (currentLng) formData.append("lng", currentLng);

                // Add audio if available
                const audioFileInput = document.getElementById("audioFile");
                if (recordedBlob) {
                    formData.append("audio", recordedBlob, "recording.wav");
                } else if (audioFileInput.files.length > 0) {
                    formData.append("audio", audioFileInput.files[0]);
                }

                console.log("Sending analysis request with 12 symptoms...");
                console.log("Symptoms:", symptomData);
                console.log("Age:", age, "Cough days:", coughDays);
                console.log("Language:", currentLang);

                // Send to backend - Use Render URL when deployed
                const backendUrl = window.location.hostname === 'localhost'
                    ? "http://localhost:5000/predict"
                    : "https://voiceguard-backend.onrender.com/predict"; // Update with your Render URL

                const response = await fetch(backendUrl, {
                    method: "POST",
                    body: formData
                });

                console.log("Response status:", response.status);
                const result = await response.json();
                console.log("Analysis result:", result);

                if (!response.ok) {
                    throw new Error(result.error || `Server error: ${response.status}`);
                }

                if (!result.success && result.error) {
                    throw new Error(result.error);
                }

                // Display results
                displayResults(result);

                // Save to Firestore
                await saveToHistory(result);

                showToast(currentLang === 'en' ? "Analysis complete!" : "‡Æ™‡Æï‡ØÅ‡Æ™‡Øç‡Æ™‡Ææ‡ÆØ‡Øç‡Æµ‡ØÅ ‡ÆÆ‡ØÅ‡Æü‡Æø‡Æ®‡Øç‡Æ§‡Æ§‡ØÅ!", "success");

            } catch (error) {
                console.error("Analysis error:", error);
                if (resultBox) {
                    resultBox.innerHTML = `
                        <div style="color: #dc3545; text-align: center; padding: 30px;">
                            <h3>${currentLang === 'en' ? 'Analysis Failed' : '‡Æ™‡Æï‡ØÅ‡Æ™‡Øç‡Æ™‡Ææ‡ÆØ‡Øç‡Æµ‡ØÅ ‡Æ§‡Øã‡Æ≤‡Øç‡Æµ‡Æø‡ÆØ‡ØÅ‡Æ±‡Øç‡Æ±‡Æ§‡ØÅ'}</h3>
                            <p style="margin: 15px 0;">${error.message}</p>
                            <div style="background: #f8d7da; padding: 15px; border-radius: 10px; margin-top: 20px; text-align: left;">
                                <strong>${currentLang === 'en' ? 'Troubleshooting:' : '‡Æö‡Æø‡Æï‡Øç‡Æï‡Æ≤‡Øç ‡Æ§‡ØÄ‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Æ≤‡Øç:'}</strong><br>
                                1. ${currentLang === 'en' ? 'Make sure backend server is running' : '‡Æ™‡Øá‡Æï‡Øç‡Æé‡Æ£‡Øç‡Æü‡Øç ‡Æö‡Æ∞‡Øç‡Æµ‡Æ∞‡Øç ‡Æá‡ÆØ‡Æô‡Øç‡Æï‡ØÅ‡Æï‡Æø‡Æ±‡Æ§‡Ææ ‡Æé‡Æ©‡Øç‡Æ™‡Æ§‡Øà‡Æö‡Øç ‡Æö‡Æ∞‡Æø‡Æ™‡Ææ‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç'}<br>
                                2. ${currentLang === 'en' ? 'Check your internet connection' : '‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æá‡Æ£‡Øà‡ÆØ ‡Æá‡Æ£‡Øà‡Æ™‡Øç‡Æ™‡Øà‡Æö‡Øç ‡Æö‡Æ∞‡Æø‡Æ™‡Ææ‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç'}<br>
                                3. ${currentLang === 'en' ? 'Try again with valid inputs' : '‡Æö‡Æ∞‡Æø‡ÆØ‡Ææ‡Æ© ‡Æâ‡Æ≥‡Øç‡Æ≥‡ØÄ‡Æü‡ØÅ‡Æï‡Æ≥‡ØÅ‡Æü‡Æ©‡Øç ‡ÆÆ‡ØÄ‡Æ£‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç ‡ÆÆ‡ØÅ‡ÆØ‡Æ±‡Øç‡Æö‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç'}<br>
                                4. ${currentLang === 'en' ? 'Check browser console for details' : '‡Æµ‡Æø‡Æµ‡Æ∞‡Æô‡Øç‡Æï‡Æ≥‡ØÅ‡Æï‡Øç‡Æï‡ØÅ ‡Æ™‡Æø‡Æ∞‡Øå‡Æö‡Æ∞‡Øç ‡Æï‡Æ©‡Øç‡Æö‡Øã‡Æ≤‡Øà ‡Æö‡Æ∞‡Æø‡Æ™‡Ææ‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç'}
                            </div>
                            <button onclick="showCheckHealth()" style="margin-top: 20px; padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer;">
                                ${currentLang === 'en' ? 'Try Again' : '‡ÆÆ‡ØÄ‡Æ£‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç ‡ÆÆ‡ØÅ‡ÆØ‡Æ±‡Øç‡Æö‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç'}
                            </button>
                        </div>
                    `;
                }
                showToast(currentLang === 'en' ? "Analysis failed: " + error.message : "‡Æ™‡Æï‡ØÅ‡Æ™‡Øç‡Æ™‡Ææ‡ÆØ‡Øç‡Æµ‡ØÅ ‡Æ§‡Øã‡Æ≤‡Øç‡Æµ‡Æø‡ÆØ‡ØÅ‡Æ±‡Øç‡Æ±‡Æ§‡ØÅ: " + error.message, "error");
            } finally {
                if (spinner) {
                    spinner.style.display = "none";
                }
            }
        }

        function displayResults(result) {
            const resultBox = document.getElementById("resultBox");
            if (!resultBox) return;

            const disease = result.disease;

            // Map Normal_Cold to display name
            let displayDisease = disease;
            let diseaseIcon = "ü©∫";

            if (disease === "Normal_Cold") {
                displayDisease = currentLang === 'en' ? "Normal Cold" : "‡Æö‡Ææ‡Æ§‡Ææ‡Æ∞‡Æ£ ‡Æï‡ØÅ‡Æ≥‡Æø‡Æ∞‡Øç";
                diseaseIcon = "ü§ß";
            } else if (disease === "COVID") {
                diseaseIcon = "ü¶†";
                displayDisease = "COVID-19";
            } else if (disease === "Asthma") {
                diseaseIcon = "ü´Å";
                displayDisease = "Asthma";
            } else if (disease === "Bronchitis") {
                diseaseIcon = "üå°Ô∏è";
                displayDisease = "Bronchitis";
            }

            const severity = currentLang === 'en' ? (result.severity_en || result.severity) : (result.severity_ta || result.severity);
            const severityCode = result.severity_code || 0;
            const recommendation = currentLang === 'en' ? (result.recommendation_en || result.recommendation) : (result.recommendation_ta || result.recommendation);
            const foodRecommendation = currentLang === 'en' ? result.food_recommendation_en : result.food_recommendation_ta;
            const covidAnalysis = currentLang === 'en' ? (result.covid_analysis_en || result.covid_analysis) : (result.covid_analysis_ta || result.covid_analysis);

            // Severity styling
            let severityClass = "severity-mild";
            let severityIcon = "üü¢";
            if (severityCode === 1) {
                severityClass = "severity-moderate";
                severityIcon = "üü°";
            } else if (severityCode === 2) {
                severityClass = "severity-severe";
                severityIcon = "üî¥";
            }

            const diseaseLabel = currentLang === 'en' ? "Detected Condition" : "‡Æï‡Æ£‡Øç‡Æü‡Æ±‡Æø‡ÆØ‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü ‡Æ®‡Æø‡Æ≤‡Øà";
            const severityLabel = currentLang === 'en' ? "Severity Level" : "‡Æ§‡ØÄ‡Æµ‡Æø‡Æ∞ ‡Æ®‡Æø‡Æ≤‡Øà";
            const recommendationLabel = currentLang === 'en' ? "General Recommendation" : "‡Æ™‡Øä‡Æ§‡ØÅ‡Æµ‡Ææ‡Æ© ‡Æ™‡Æ∞‡Æø‡Æ®‡Øç‡Æ§‡ØÅ‡Æ∞‡Øà";
            const foodLabel = currentLang === 'en' ? "Dietary Advice (Food)" : "‡Æâ‡Æ£‡Æµ‡ØÅ ‡ÆÆ‡ØÅ‡Æ±‡Øà ‡ÆÜ‡Æ≤‡Øã‡Æö‡Æ©‡Øà‡Æï‡Æ≥‡Øç";
            const covidLabel = currentLang === 'en' ? "COVID Analysis" : "‡Æï‡Øã‡Æµ‡Æø‡Æü‡Øç ‡Æ™‡Æï‡ØÅ‡Æ™‡Øç‡Æ™‡Ææ‡ÆØ‡Øç‡Æµ‡ØÅ";
            const confidenceLabel = currentLang === 'en' ? "Confidence" : "‡Æ®‡ÆÆ‡Øç‡Æ™‡Æø‡Æï‡Øç‡Æï‡Øà";
            const hospitalLabel = currentLang === 'en' ? "Recommended Nearby Hospitals" : "‡Æ™‡Æ∞‡Æø‡Æ®‡Øç‡Æ§‡ØÅ‡Æ∞‡Øà‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡ØÅ‡ÆÆ‡Øç ‡ÆÖ‡Æ∞‡ØÅ‡Æï‡Æø‡Æ≤‡ØÅ‡Æ≥‡Øç‡Æ≥ ‡ÆÆ‡Æ∞‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ‡Æµ‡ÆÆ‡Æ©‡Øà‡Æï‡Æ≥‡Øç";

            // Prepare hospital list HTML
            let hospitalsHtml = "";
            if (result.nearby_hospitals && result.nearby_hospitals.length > 0) {
                result.nearby_hospitals.forEach(h => {
                    const verifiedBadge = h.is_verified
                        ? `<span style="background: #E3F2FD; color: #1976D2; padding: 2px 8px; border-radius: 4px; font-size: 0.75em; font-weight: bold; margin-bottom: 5px; display: inline-block; border: 1px solid #BBDEFB;">‚úÖ Verified Specialist Center</span>`
                        : `<span style="background: #F5F5F5; color: #666; padding: 2px 8px; border-radius: 4px; font-size: 0.75em; font-weight: bold; margin-bottom: 5px; display: inline-block; border: 1px solid #E0E0E0;">üåê Nearby Facility</span>`;

                    const specialistsHtml = (h.specialists && h.specialists.length > 0)
                        ? `<strong>üë®‚Äç‚öïÔ∏è ${currentLang === 'en' ? 'Specialists for' : '‡Æá‡Æ§‡Æ±‡Øç‡Æï‡Ææ‡Æ© ‡Æö‡Æø‡Æ±‡Æ™‡Øç‡Æ™‡ØÅ ‡ÆÆ‡Æ∞‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ‡Æµ‡Æ∞‡Øç‡Æï‡Æ≥‡Øç'} ${displayDisease}:</strong><br>
                           <span style="color: #667eea;">${h.specialists.join(', ')}</span>`
                        : `<strong>üè• Service:</strong><br><span style="color: #666;">${(h.expertise && h.expertise[0]) || 'General Medical Care'}</span>`;

                    hospitalsHtml += `
                        <div style="background: #fff; padding: 12px; border-radius: 8px; margin-top: 10px; border: 1px solid #eee; font-size: 0.9em; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                            ${verifiedBadge}<br>
                            <strong style="color: #FF85B3;">${h.name}</strong> (${h.distance} km)<br>
                            <div style="margin: 5px 0; color: #333;">
                                ${specialistsHtml}
                            </div>
                            <span style="color: #666;">‚è∞ ${h.timings}</span><br>
                            <div style="margin-top: 8px; display: flex; gap: 10px;">
                                <a href="tel:${h.phone}" style="color: #667eea; text-decoration: none; font-weight: bold;">üìû ${h.phone}</a>
                                <a href="${h.map_url}" target="_blank" style="color: #FF85B3; text-decoration: none; font-weight: bold;">üìç View on Maps</a>
                            </div>
                        </div>
                    `;
                });
            } else {
                if (!currentLat || !currentLng) {
                    hospitalsHtml = `
                        <div style="background: #f0f4ff; padding: 15px; border-radius: 10px; border: 1px dashed #667eea; text-align: center;">
                            <p style="color: #1f2a8c; margin: 0; font-size: 0.9em;">
                                üìç ${currentLang === 'en'
                            ? 'If you let us use your location, the nearest specialist hospitals will be shown here.'
                            : '‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æá‡Æ∞‡ØÅ‡Æ™‡Øç‡Æ™‡Æø‡Æü‡Æ§‡Øç‡Æ§‡Øà ‡ÆÖ‡Æ©‡ØÅ‡ÆÆ‡Æ§‡Æø‡Æ§‡Øç‡Æ§‡Ææ‡Æ≤‡Øç, ‡ÆÖ‡Æ∞‡ØÅ‡Æï‡Æø‡Æ≤‡ØÅ‡Æ≥‡Øç‡Æ≥ ‡Æö‡Æø‡Æ±‡Æ™‡Øç‡Æ™‡ØÅ ‡ÆÆ‡Æ∞‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ‡Æµ‡ÆÆ‡Æ©‡Øà‡Æï‡Æ≥‡Øç ‡Æá‡Æô‡Øç‡Æï‡Øá ‡Æï‡Ææ‡Æ£‡Øç‡Æ™‡Æø‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡ØÅ‡ÆÆ‡Øç.'}
                            </p>
                        </div>
                    `;
                } else {
                    hospitalsHtml = `<p style="color: #888; font-size: 0.9em;">${currentLang === 'en' ? 'No nearby specialist hospitals found based on your location.' : '‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æá‡Æ∞‡ØÅ‡Æ™‡Øç‡Æ™‡Æø‡Æü‡Æ§‡Øç‡Æ§‡Æø‡Æ©‡Øç ‡ÆÖ‡Æü‡Æø‡Æ™‡Øç‡Æ™‡Æü‡Øà‡ÆØ‡Æø‡Æ≤‡Øç ‡ÆÖ‡Æ∞‡ØÅ‡Æï‡Æø‡Æ≤‡ØÅ‡Æ≥‡Øç‡Æ≥ ‡Æö‡Æø‡Æ±‡Æ™‡Øç‡Æ™‡ØÅ ‡ÆÆ‡Æ∞‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ‡Æµ‡ÆÆ‡Æ©‡Øà‡Æï‡Æ≥‡Øç ‡Æé‡Æ§‡ØÅ‡Æµ‡ØÅ‡ÆÆ‡Øç ‡Æï‡Æø‡Æü‡Øà‡Æï‡Øç‡Æï‡Æµ‡Æø‡Æ≤‡Øç‡Æ≤‡Øà.'}</p>`;
                }
            }

            resultBox.innerHTML = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <div style="font-size: 3rem; margin-bottom: 10px;">${diseaseIcon}</div>
                    <h3 style="color: #1f2a8c; margin-bottom: 10px;">${displayDisease}</h3>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <strong>${diseaseLabel}:</strong> ${displayDisease}<br><br>
                    
                    <strong>${severityLabel}:</strong> ${severityIcon} <span class="severity-badge ${severityClass}">${severity}</span><br><br>
                    
                    <strong>${confidenceLabel}:</strong> ${result.confidence || 'N/A'}<br><br>
                    
                    ${covidAnalysis && typeof covidAnalysis === 'string' && covidAnalysis.trim() !== '' && !covidAnalysis.toLowerCase().includes('not analyzed') && !covidAnalysis.toLowerCase().includes('‡ÆÜ‡ÆØ‡Øç‡Æµ‡ØÅ') ? `<strong>${covidLabel}:</strong> ${covidAnalysis}<br><br>` : ''}
                    
                    <strong>${recommendationLabel}:</strong><br>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 10px; border-left: 4px solid #667eea;">
                        ${recommendation || (currentLang === 'en' ? 'Please consult a healthcare professional for medical advice.' : '‡ÆÆ‡Æ∞‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ‡Æµ ‡ÆÜ‡Æ≤‡Øã‡Æö‡Æ©‡Øà‡Æï‡Øç‡Æï‡ØÅ ‡Æö‡ØÅ‡Æï‡Ææ‡Æ§‡Ææ‡Æ∞ ‡Æ®‡Æø‡Æ™‡ØÅ‡Æ£‡Æ∞‡Øà ‡ÆÖ‡Æ£‡ØÅ‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç.')}
                    </div><br>

                    <strong>${foodLabel}:</strong><br>
                    <div style="background: #fff9e6; padding: 15px; border-radius: 10px; margin-top: 10px; border-left: 4px solid #FFD700;">
                        üçé ${foodRecommendation || (currentLang === 'en' ? 'Maintain a balanced diet and stay hydrated.' : '‡Æö‡ØÄ‡Æ∞‡Ææ‡Æ© ‡Æâ‡Æ£‡Æµ‡Øà‡Æ™‡Øç ‡Æ™‡Æ∞‡Ææ‡ÆÆ‡Æ∞‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æ®‡ØÄ‡Æ∞‡Øá‡Æ±‡Øç‡Æ±‡ÆÆ‡Ææ‡Æï ‡Æá‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç.')}
                    </div><br>

                    <strong>${hospitalLabel}:</strong><br>
                    ${hospitalsHtml}
                </div>
                
                <div style="margin-top: 25px; padding: 15px; background: #f0f8ff; border-radius: 10px; font-size: 0.9em;">
                    <strong>${currentLang === 'en' ? 'Important Note:' : '‡ÆÆ‡ØÅ‡Æï‡Øç‡Æï‡Æø‡ÆØ ‡Æï‡ØÅ‡Æ±‡Æø‡Æ™‡Øç‡Æ™‡ØÅ:'}</strong><br>
                    ${currentLang === 'en'
                    ? 'This is a screening tool, not a medical diagnosis. Please consult a healthcare professional for proper medical advice.'
                    : '‡Æá‡Æ§‡ØÅ ‡Æí‡Æ∞‡ØÅ ‡Æ™‡Æ∞‡Æø‡Æö‡Øã‡Æ§‡Æ©‡Øà ‡Æï‡Æ∞‡ØÅ‡Æµ‡Æø, ‡ÆÆ‡Æ∞‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ‡Æµ ‡Æ®‡Øã‡ÆØ‡Øç ‡Æï‡Æ£‡Øç‡Æü‡Æ±‡Æø‡Æ§‡Æ≤‡Øç ‡ÆÖ‡Æ≤‡Øç‡Æ≤. ‡Æö‡Æ∞‡Æø‡ÆØ‡Ææ‡Æ© ‡ÆÆ‡Æ∞‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ‡Æµ ‡ÆÜ‡Æ≤‡Øã‡Æö‡Æ©‡Øà‡Æï‡Øç‡Æï‡ØÅ ‡Æö‡ØÅ‡Æï‡Ææ‡Æ§‡Ææ‡Æ∞ ‡Æ®‡Æø‡Æ™‡ØÅ‡Æ£‡Æ∞‡Øà ‡ÆÖ‡Æ£‡ØÅ‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç.'}
                </div>
            `;
        }

        async function saveToHistory(result) {
            if (!loggedUser || !currentPatient) return;

            try {
                const age = document.getElementById("age").value;
                const coughDays = document.getElementById("cough_days").value;
                const severity = currentLang === 'en' ? (result.severity_en || result.severity) : (result.severity_ta || result.severity);
                const recommendation = currentLang === 'en' ? (result.recommendation_en || result.recommendation) : (result.recommendation_ta || result.recommendation);
                const covidAnalysis = currentLang === 'en' ? (result.covid_analysis_en || result.covid_analysis) : (result.covid_analysis_ta || result.covid_analysis);

                const screeningData = {
                    userId: loggedUser || "anonymous",
                    patientName: currentPatient || "Unknown",
                    age: age || "N/A",
                    coughDays: coughDays || "0",
                    symptoms: symptomData || {},
                    disease: result.disease || "Unknown",
                    severity: severity || "Mild",
                    severity_code: result.severity_code !== undefined ? result.severity_code : 0,
                    recommendation: recommendation || "No recommendation available.",
                    confidence: result.confidence || "0%",
                    covidAnalysis: covidAnalysis || "No analysis details available.",
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                };

                await db.collection('screenings').add(screeningData);

                console.log("Screening saved to Firestore");

            } catch (error) {
                console.error("Error saving to Firestore:", error);
            }
        }

        function downloadReport() {
            const resultBox = document.getElementById("resultBox");
            if (!resultBox) return;

            const content = resultBox.innerText;
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `VoiceGuard_Report_${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showToast(currentLang === 'en' ? "Report downloaded!" : "‡ÆÖ‡Æ±‡Æø‡Æï‡Øç‡Æï‡Øà ‡Æ™‡Æ§‡Æø‡Æµ‡Æø‡Æ±‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ!", "success");
        }

        // ===== HISTORY MANAGEMENT =====
        async function showHistory() {
            if (!loggedUser) {
                showToast(currentLang === 'en' ? "Please login first" : "‡ÆÆ‡ØÅ‡Æ§‡Æ≤‡Æø‡Æ≤‡Øç ‡Æâ‡Æ≥‡Øç‡Æ®‡ØÅ‡Æ¥‡Øà‡ÆØ‡Æµ‡ØÅ‡ÆÆ‡Øç", "error");
                show("login");
                return;
            }

            let sel = document.getElementById("historyPatients");
            if (!sel) return;

            sel.innerHTML = "";
            let defaultOpt = document.createElement("option");
            defaultOpt.value = "";
            defaultOpt.text = currentLang === 'en' ? "-- Select Patient --" : "-- ‡Æ®‡Øã‡ÆØ‡Ææ‡Æ≥‡Æø‡ÆØ‡Øà‡Æ§‡Øç ‡Æ§‡Øá‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÜ‡Æü‡ØÅ‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç --";
            sel.appendChild(defaultOpt);

            try {
                const userDoc = await db.collection('users').doc(loggedUser).get();
                const familyMembers = userDoc.data()?.familyMembers || [];

                familyMembers.forEach(p => {
                    let o = document.createElement("option");
                    o.text = o.value = p;
                    sel.appendChild(o);
                });

            } catch (error) {
                console.error("Error loading patients for history:", error);
            }

            await loadHistory();
            show("history");
        }

        async function loadHistory() {
            let patientSelect = document.getElementById("historyPatients");
            if (!patientSelect) return;

            let patient = patientSelect.value;
            let box = document.getElementById("historyBox");
            if (!box) return;

            box.innerHTML = "";

            if (!patient) {
                box.innerHTML = `<p style="text-align:center;color:#666;padding:20px;">
                    ${currentLang === 'en' ? 'Please select a patient to view history.' : '‡Æµ‡Æ∞‡Æ≤‡Ææ‡Æ±‡Øç‡Æ±‡Øà‡Æï‡Øç ‡Æï‡Ææ‡Æ£ ‡Æ®‡Øã‡ÆØ‡Ææ‡Æ≥‡Æø‡ÆØ‡Øà‡Æ§‡Øç ‡Æ§‡Øá‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÜ‡Æü‡ØÅ‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç.'}
                </p>`;
                return;
            }

            try {
                const querySnapshot = await db.collection('screenings')
                    .where('userId', '==', loggedUser)
                    .where('patientName', '==', patient)
                    .orderBy('timestamp', 'desc')
                    .limit(20)
                    .get();

                if (querySnapshot.empty) {
                    box.innerHTML = `<p style="text-align:center;color:#666;padding:20px;">
                        ${currentLang === 'en' ? 'No screenings found for this patient.' : '‡Æá‡Æ®‡Øç‡Æ§ ‡Æ®‡Øã‡ÆØ‡Ææ‡Æ≥‡Æø‡Æï‡Øç‡Æï‡ØÅ ‡Æ™‡Æ∞‡Æø‡Æö‡Øã‡Æ§‡Æ©‡Øà‡Æï‡Æ≥‡Øç ‡Æé‡Æ§‡ØÅ‡Æµ‡ØÅ‡ÆÆ‡Øç ‡Æï‡Æø‡Æü‡Øà‡Æï‡Øç‡Æï‡Æµ‡Æø‡Æ≤‡Øç‡Æ≤‡Øà.'}
                    </p>`;
                    return;
                }

                let count = 0;
                querySnapshot.forEach((doc) => {
                    count++;
                    const data = doc.data();
                    const date = data.timestamp?.toDate() || new Date();

                    let severityClass = "severity-mild";
                    if (data.severity_code === 1) severityClass = "severity-moderate";
                    if (data.severity_code === 2) severityClass = "severity-severe";

                    box.innerHTML += `
                        <div style="background:white;padding:20px;border-radius:12px;margin-bottom:15px;box-shadow:0 5px 15px rgba(0,0,0,0.05);border:1px solid #e0e0e0;">
                            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
                                <h4 style="color:#667eea;margin:0;">#${count}</h4>
                                <span style="font-size:0.9em;color:#666;">${date.toLocaleString()}</span>
                            </div>
                            
                            <p><strong>${currentLang === 'en' ? 'Condition:' : '‡Æ®‡Æø‡Æ≤‡Øà:'}</strong> ${data.disease}</p>
                            <p><strong>${currentLang === 'en' ? 'Severity:' : '‡Æ§‡ØÄ‡Æµ‡Æø‡Æ∞‡ÆÆ‡Øç:'}</strong> <span class="severity-badge ${severityClass}">${data.severity}</span></p>
                            <p><strong>${currentLang === 'en' ? 'Confidence:' : '‡Æ®‡ÆÆ‡Øç‡Æ™‡Æø‡Æï‡Øç‡Æï‡Øà:'}</strong> ${data.confidence || 'N/A'}</p>
                            
                            ${data.covidAnalysis && typeof data.covidAnalysis === 'string' && data.covidAnalysis.trim() !== '' ?
                            `<p><strong>${currentLang === 'en' ? 'COVID Analysis:' : '‡Æï‡Øã‡Æµ‡Æø‡Æü‡Øç ‡Æ™‡Æï‡ØÅ‡Æ™‡Øç‡Æ™‡Ææ‡ÆØ‡Øç‡Æµ‡ØÅ:'}</strong> ${data.covidAnalysis}</p>` : ''}
                            
                            <p style="margin-top:10px;padding:10px;background:#f8f9fa;border-radius:8px;font-size:0.9em;">
                                <strong>${currentLang === 'en' ? 'Note:' : '‡Æï‡ØÅ‡Æ±‡Æø‡Æ™‡Øç‡Æ™‡ØÅ:'}</strong> ${data.recommendation}
                            </p>
                        </div>
                    `;
                });

            } catch (error) {
                console.error("Error loading history:", error);

                let errorMsg = currentLang === 'en'
                    ? 'Error loading history. Please try again.'
                    : '‡Æµ‡Æ∞‡Æ≤‡Ææ‡Æ±‡Øç‡Æ±‡Øà ‡Æè‡Æ±‡Øç‡Æ±‡ØÅ‡Æµ‡Æ§‡Æø‡Æ≤‡Øç ‡Æ™‡Æø‡Æ¥‡Øà. ‡ÆÆ‡ØÄ‡Æ£‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç ‡ÆÆ‡ØÅ‡ÆØ‡Æ±‡Øç‡Æö‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç.';

                if (error.message && error.message.includes('index')) {
                    errorMsg = currentLang === 'en'
                        ? 'This query requires an index. Please check the browser console and follow the link to create it.'
                        : '‡Æá‡Æ®‡Øç‡Æ§‡Æ§‡Øç ‡Æ§‡Øá‡Æü‡Æ≤‡ØÅ‡Æï‡Øç‡Æï‡ØÅ ‡Æí‡Æ∞‡ØÅ ‡Æï‡ØÅ‡Æ±‡Æø‡ÆØ‡ØÄ‡Æü‡ØÅ (index) ‡Æ§‡Øá‡Æµ‡Øà. ‡Æ™‡Æø‡Æ∞‡Øå‡Æö‡Æ∞‡Øç ‡Æï‡Æ©‡Øç‡Æö‡Øã‡Æ≤‡Øà‡Æö‡Øç ‡Æö‡Æ∞‡Æø‡Æ™‡Ææ‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç.';
                }

                box.innerHTML = `<p style="text-align:center;color:#dc3545;padding:20px;">
                    ${errorMsg}
                </p>`;
            }
        }

        // ===== LANGUAGE SETTINGS =====
        function setLanguage(lang) {
            currentLang = lang;

            // Update button states
            document.getElementById('btnEn').classList.toggle('active', lang === 'en');
            document.getElementById('btnTa').classList.toggle('active', lang === 'ta');

            // Update all translatable elements
            document.querySelectorAll('[data-en]:not([data-static])').forEach(el => {
                el.textContent = el.getAttribute(lang === 'en' ? 'data-en' : 'data-ta');
            });

            document.querySelectorAll('[data-en-placeholder]').forEach(el => {
                el.placeholder = el.getAttribute(
                    lang === 'en' ? 'data-en-placeholder' : 'data-ta-placeholder'
                );
            });

            // Update symptom labels
            document.querySelectorAll('.symptom-label').forEach((el, idx) => {
                if (symptoms[idx]) {
                    el.textContent = translations[symptoms[idx]][lang];
                }
            });

            // Update Yes/No buttons
            document.querySelectorAll('.yes-choice').forEach(el => {
                el.textContent = lang === 'en' ? 'Yes' : '‡ÆÜ‡ÆÆ‡Øç';
            });

            document.querySelectorAll('.no-choice').forEach(el => {
                el.textContent = lang === 'en' ? 'No' : '‡Æá‡Æ≤‡Øç‡Æ≤‡Øà';
            });

            // Update dropdown placeholders
            const patientDropdown = document.getElementById("patientDropdown");
            if (patientDropdown && patientDropdown.options[0]) {
                patientDropdown.options[0].text = lang === 'en'
                    ? "-- Select Patient --"
                    : "-- ‡Æ®‡Øã‡ÆØ‡Ææ‡Æ≥‡Æø‡ÆØ‡Øà‡Æ§‡Øç ‡Æ§‡Øá‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÜ‡Æü‡ØÅ‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç --";
            }

            const historyPatients = document.getElementById("historyPatients");
            if (historyPatients && historyPatients.options[0]) {
                historyPatients.options[0].text = lang === 'en'
                    ? "-- Select Patient --"
                    : "-- ‡Æ®‡Øã‡ÆØ‡Ææ‡Æ≥‡Æø‡ÆØ‡Øà‡Æ§‡Øç ‡Æ§‡Øá‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÜ‡Æü‡ØÅ‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç --";
            }

            // Update user status
            const userStatus = document.getElementById("userStatus");
            if (userStatus && loggedUser) {
                userStatus.textContent = lang === 'en' ? "Logged in" : "‡Æâ‡Æ≥‡Øç‡Æ®‡ØÅ‡Æ¥‡Øà‡Æ®‡Øç‡Æ§‡ØÅ‡Æ≥‡Øç‡Æ≥‡Ææ‡Æ∞‡Øç";
            }

            showToast(
                lang === 'en' ? "Language changed to English" : "‡ÆÆ‡Øä‡Æ¥‡Æø ‡Æ§‡ÆÆ‡Æø‡Æ¥‡ØÅ‡Æï‡Øç‡Æï‡ØÅ ‡ÆÆ‡Ææ‡Æ±‡Øç‡Æ±‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ",
                "success"
            );
        }

        // ===== BACKEND CONNECTION TEST =====
        async function testBackendConnection() {
            try {
                const backendUrl = window.location.hostname === 'localhost'
                    ? "http://localhost:5000/health"
                    : "https://voiceguard-backend.onrender.com/health"; // Update with your Render URL

                const response = await fetch(backendUrl, {
                    method: "GET",
                    mode: "cors"
                });

                if (response.ok) {
                    const data = await response.json();
                    console.log("‚úÖ Backend connection successful:", data);
                    showToast(
                        currentLang === 'en' ? "Backend connected successfully!" : "‡Æ™‡Øá‡Æï‡Øç‡Æé‡Æ£‡Øç‡Æü‡Øç ‡Æµ‡ØÜ‡Æ±‡Øç‡Æ±‡Æø‡Æï‡Æ∞‡ÆÆ‡Ææ‡Æï ‡Æá‡Æ£‡Øà‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ!",
                        "success"
                    );
                } else {
                    console.warn("‚ö†Ô∏è Backend connection issue");
                    showToast(
                        currentLang === 'en' ? "Backend server issue detected" : "‡Æ™‡Øá‡Æï‡Øç‡Æé‡Æ£‡Øç‡Æü‡Øç ‡Æö‡Æ∞‡Øç‡Æµ‡Æ∞‡Øç ‡Æö‡Æø‡Æï‡Øç‡Æï‡Æ≤‡Øç ‡Æï‡Æ£‡Øç‡Æü‡Æ±‡Æø‡ÆØ‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ",
                        "error"
                    );
                }
            } catch (error) {
                console.error("‚ùå Backend connection failed:", error);
                showToast(
                    currentLang === 'en'
                        ? "Backend connection failed. Make sure server is running."
                        : "‡Æ™‡Øá‡Æï‡Øç‡Æé‡Æ£‡Øç‡Æü‡Øç ‡Æá‡Æ£‡Øà‡Æ™‡Øç‡Æ™‡ØÅ ‡Æ§‡Øã‡Æ≤‡Øç‡Æµ‡Æø‡ÆØ‡ØÅ‡Æ±‡Øç‡Æ±‡Æ§‡ØÅ. ‡Æö‡Æ∞‡Øç‡Æµ‡Æ∞‡Øç ‡Æá‡ÆØ‡Æô‡Øç‡Æï‡ØÅ‡Æï‡Æø‡Æ±‡Æ§‡Ææ ‡Æé‡Æ©‡Øç‡Æ™‡Æ§‡Øà‡Æö‡Øç ‡Æö‡Æ∞‡Æø‡Æ™‡Ææ‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç.",
                    "error"
                );
            }
        }

        // ===== FILE UPLOAD HANDLER =====
        document.getElementById('audioFile')?.addEventListener('change', function (e) {
            const file = e.target.files[0];
            if (file) {
                if (file.type.startsWith('audio/')) {
                    recordedBlob = file;
                    const playback = document.getElementById("playback");
                    if (playback) {
                        playback.src = URL.createObjectURL(file);
                    }
                    showToast(
                        currentLang === 'en' ? "Audio file loaded successfully" : "‡ÆÜ‡Æü‡Æø‡ÆØ‡Øã ‡Æï‡Øã‡Æ™‡Øç‡Æ™‡ØÅ ‡Æµ‡ØÜ‡Æ±‡Øç‡Æ±‡Æø‡Æï‡Æ∞‡ÆÆ‡Ææ‡Æï ‡Æè‡Æ±‡Øç‡Æ±‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ",
                        "success"
                    );
                } else {
                    showToast(
                        currentLang === 'en' ? "Please select an audio file" : "‡Æí‡Æ∞‡ØÅ ‡ÆÜ‡Æü‡Æø‡ÆØ‡Øã ‡Æï‡Øã‡Æ™‡Øç‡Æ™‡Øà‡Æ§‡Øç ‡Æ§‡Øá‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÜ‡Æü‡ØÅ‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç",
                        "error"
                    );
                    this.value = "";
                }
            }
        });

    </script>

</body>

</html>